<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://www.cs.york.ac.uk/fp/darcs/hscolour/ -->
<title>src/Snap/Http/Server/Config.hs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="line-1"></a><span class='hs-comment'>{-# LANGUAGE CPP #-}</span>
<a name="line-2"></a><span class='hs-comment'>{-# LANGUAGE OverloadedStrings #-}</span>
<a name="line-3"></a>
<a name="line-4"></a><span class='hs-comment'>{-|
<a name="line-5"></a>
<a name="line-6"></a>This module exports the 'Config' datatype which represents partially-specified
<a name="line-7"></a>configurations of \"serve\" functions which run 'Snap' actions in 'IO'.
<a name="line-8"></a>
<a name="line-9"></a>-}</span>
<a name="line-10"></a>
<a name="line-11"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>Snap</span><span class='hs-varop'>.</span><span class='hs-conid'>Http</span><span class='hs-varop'>.</span><span class='hs-conid'>Server</span><span class='hs-varop'>.</span><span class='hs-conid'>Config</span>
<a name="line-12"></a>  <span class='hs-layout'>(</span> <span class='hs-conid'>Config</span>
<a name="line-13"></a>  <span class='hs-layout'>,</span> <span class='hs-conid'>ConfigListen</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span>
<a name="line-14"></a>  <span class='hs-layout'>,</span> <span class='hs-conid'>ConfigBackend</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span>
<a name="line-15"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>emptyConfig</span>
<a name="line-16"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>defaultConfig</span>
<a name="line-17"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>completeConfig</span>
<a name="line-18"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>commandLineConfig</span>
<a name="line-19"></a>
<a name="line-20"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>getHostname</span>
<a name="line-21"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>getListen</span>
<a name="line-22"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>getAccessLog</span>
<a name="line-23"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>getErrorLog</span>
<a name="line-24"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>getLocale</span>
<a name="line-25"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>getBackend</span>
<a name="line-26"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>getCompression</span>
<a name="line-27"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>getVerbose</span>
<a name="line-28"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>getErrorHandler</span>
<a name="line-29"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>getDefaultTimeout</span>
<a name="line-30"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>getOther</span>
<a name="line-31"></a>
<a name="line-32"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>setHostname</span>
<a name="line-33"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>addListen</span>
<a name="line-34"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>setAccessLog</span>
<a name="line-35"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>setErrorLog</span>
<a name="line-36"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>setLocale</span>
<a name="line-37"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>setBackend</span>
<a name="line-38"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>setCompression</span>
<a name="line-39"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>setVerbose</span>
<a name="line-40"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>setErrorHandler</span>
<a name="line-41"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>setDefaultTimeout</span>
<a name="line-42"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>setOther</span>
<a name="line-43"></a>  <span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-44"></a>
<a name="line-45"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>Blaze</span><span class='hs-varop'>.</span><span class='hs-conid'>ByteString</span><span class='hs-varop'>.</span><span class='hs-conid'>Builder</span>
<a name="line-46"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>Control</span><span class='hs-varop'>.</span><span class='hs-conid'>Exception</span> <span class='hs-layout'>(</span><span class='hs-conid'>SomeException</span><span class='hs-layout'>)</span>
<a name="line-47"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>Control</span><span class='hs-varop'>.</span><span class='hs-conid'>Monad</span>
<a name="line-48"></a><span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>ByteString</span><span class='hs-varop'>.</span><span class='hs-conid'>UTF8</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>U</span>
<a name="line-49"></a><span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>ByteString</span><span class='hs-varop'>.</span><span class='hs-conid'>Char8</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>B</span>
<a name="line-50"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>ByteString</span> <span class='hs-layout'>(</span><span class='hs-conid'>ByteString</span><span class='hs-layout'>)</span>
<a name="line-51"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Char</span>
<a name="line-52"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>List</span>
<a name="line-53"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Monoid</span>
<a name="line-54"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>Prelude</span> <span class='hs-varid'>hiding</span> <span class='hs-layout'>(</span><span class='hs-varid'>catch</span><span class='hs-layout'>)</span>
<a name="line-55"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>Snap</span><span class='hs-varop'>.</span><span class='hs-conid'>Types</span>
<a name="line-56"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>Snap</span><span class='hs-varop'>.</span><span class='hs-conid'>Iteratee</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varop'>&gt;==&gt;</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>enumBuilder</span><span class='hs-layout'>)</span>
<a name="line-57"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>System</span><span class='hs-varop'>.</span><span class='hs-conid'>Console</span><span class='hs-varop'>.</span><span class='hs-conid'>GetOpt</span>
<a name="line-58"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>System</span><span class='hs-varop'>.</span><span class='hs-conid'>Environment</span> <span class='hs-varid'>hiding</span> <span class='hs-layout'>(</span><span class='hs-varid'>getEnv</span><span class='hs-layout'>)</span>
<a name="line-59"></a><span class='hs-cpp'>#ifndef PORTABLE</span>
<a name="line-60"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>System</span><span class='hs-varop'>.</span><span class='hs-conid'>Posix</span><span class='hs-varop'>.</span><span class='hs-conid'>Env</span>
<a name="line-61"></a><span class='hs-cpp'>#endif</span>
<a name="line-62"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>System</span><span class='hs-varop'>.</span><span class='hs-conid'>Exit</span>
<a name="line-63"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>System</span><span class='hs-varop'>.</span><span class='hs-conid'>IO</span>
<a name="line-64"></a>
<a name="line-65"></a><a name="ConfigListen"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-66"></a><a name="ConfigListen"></a><span class='hs-comment'>-- | A data type to store the bind address and port to listen on.</span>
<a name="line-67"></a><a name="ConfigListen"></a><span class='hs-comment'>--</span>
<a name="line-68"></a><a name="ConfigListen"></a><span class='hs-comment'>--  For SSL support, it also stores the path to the certificate in PEM format</span>
<a name="line-69"></a><a name="ConfigListen"></a><span class='hs-comment'>--  and the path to the private key in PEM format</span>
<a name="line-70"></a><a name="ConfigListen"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>ConfigListen</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ListenHttp</span>  <span class='hs-conid'>ByteString</span> <span class='hs-conid'>Int</span>
<a name="line-71"></a>                  <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ListenHttps</span> <span class='hs-conid'>ByteString</span> <span class='hs-conid'>Int</span> <span class='hs-conid'>FilePath</span> <span class='hs-conid'>FilePath</span>
<a name="line-72"></a>
<a name="line-73"></a>
<a name="line-74"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Show</span> <span class='hs-conid'>ConfigListen</span> <span class='hs-keyword'>where</span>
<a name="line-75"></a>    <span class='hs-varid'>show</span> <span class='hs-layout'>(</span><span class='hs-conid'>ListenHttp</span> <span class='hs-varid'>b</span> <span class='hs-varid'>p</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-str'>"http://"</span> <span class='hs-varop'>++</span> <span class='hs-conid'>U</span><span class='hs-varop'>.</span><span class='hs-varid'>toString</span> <span class='hs-varid'>b</span> <span class='hs-varop'>++</span> <span class='hs-str'>":"</span> <span class='hs-varop'>++</span> <span class='hs-varid'>show</span> <span class='hs-varid'>p</span>
<a name="line-76"></a>    <span class='hs-varid'>show</span> <span class='hs-layout'>(</span><span class='hs-conid'>ListenHttps</span> <span class='hs-varid'>b</span> <span class='hs-varid'>p</span> <span class='hs-varid'>c</span> <span class='hs-varid'>k</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span>
<a name="line-77"></a>        <span class='hs-str'>"https://"</span> <span class='hs-varop'>++</span> <span class='hs-conid'>U</span><span class='hs-varop'>.</span><span class='hs-varid'>toString</span> <span class='hs-varid'>b</span> <span class='hs-varop'>++</span> <span class='hs-str'>":"</span> <span class='hs-varop'>++</span> <span class='hs-varid'>show</span> <span class='hs-varid'>p</span> <span class='hs-varop'>++</span>
<a name="line-78"></a>        <span class='hs-str'>" (cert = "</span> <span class='hs-varop'>++</span> <span class='hs-varid'>show</span> <span class='hs-varid'>c</span> <span class='hs-varop'>++</span> <span class='hs-str'>", key = "</span> <span class='hs-varop'>++</span> <span class='hs-varid'>show</span> <span class='hs-varid'>k</span> <span class='hs-varop'>++</span> <span class='hs-str'>")"</span>
<a name="line-79"></a>
<a name="line-80"></a>
<a name="line-81"></a><a name="ConfigBackend"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-82"></a><a name="ConfigBackend"></a><span class='hs-comment'>-- | A data type to record which backend event loop should be used when</span>
<a name="line-83"></a><a name="ConfigBackend"></a><span class='hs-comment'>-- serving data.</span>
<a name="line-84"></a><a name="ConfigBackend"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>ConfigBackend</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ConfigSimpleBackend</span>
<a name="line-85"></a>                   <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ConfigLibEvBackend</span>
<a name="line-86"></a>    <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Eq</span><span class='hs-layout'>,</span><span class='hs-conid'>Show</span><span class='hs-layout'>)</span>
<a name="line-87"></a>
<a name="line-88"></a>
<a name="line-89"></a><a name="Config"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-90"></a><a name="Config"></a><span class='hs-comment'>-- | A record type which represents partial configurations (for 'httpServe')</span>
<a name="line-91"></a><a name="Config"></a><span class='hs-comment'>-- by wrapping all of its fields in a 'Maybe'. Values of this type are usually</span>
<a name="line-92"></a><a name="Config"></a><span class='hs-comment'>-- constructed via its 'Monoid' instance by doing something like:</span>
<a name="line-93"></a><a name="Config"></a><span class='hs-comment'>--</span>
<a name="line-94"></a><a name="Config"></a><span class='hs-comment'>-- &gt; addListen (ListenHttp "0.0.0.0" 9000) mempty</span>
<a name="line-95"></a><a name="Config"></a><span class='hs-comment'>--</span>
<a name="line-96"></a><a name="Config"></a><span class='hs-comment'>-- Any fields which are unspecified in the 'Config' passed to 'httpServe' (and</span>
<a name="line-97"></a><a name="Config"></a><span class='hs-comment'>-- this is the norm) are filled in with default values from 'defaultConfig'.</span>
<a name="line-98"></a><a name="Config"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>MonadSnap</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Config</span>
<a name="line-99"></a>    <span class='hs-layout'>{</span> <span class='hs-varid'>hostname</span>       <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>ByteString</span>
<a name="line-100"></a>      <span class='hs-comment'>-- ^ The name of the server</span>
<a name="line-101"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>listen</span>         <span class='hs-keyglyph'>::</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>ConfigListen</span><span class='hs-keyglyph'>]</span>
<a name="line-102"></a>      <span class='hs-comment'>-- ^ The local interfaces to listen on</span>
<a name="line-103"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>accessLog</span>      <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-conid'>FilePath</span><span class='hs-layout'>)</span>
<a name="line-104"></a>      <span class='hs-comment'>-- ^ The path to the access log</span>
<a name="line-105"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>errorLog</span>       <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-conid'>FilePath</span><span class='hs-layout'>)</span>
<a name="line-106"></a>      <span class='hs-comment'>-- ^ The path to the error log</span>
<a name="line-107"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>locale</span>         <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>String</span>
<a name="line-108"></a>      <span class='hs-comment'>-- ^ The locale to use</span>
<a name="line-109"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>backend</span>        <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>ConfigBackend</span>
<a name="line-110"></a>      <span class='hs-comment'>-- ^ The backend to use</span>
<a name="line-111"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>compression</span>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>Bool</span>
<a name="line-112"></a>      <span class='hs-comment'>-- ^ Whether to use compression</span>
<a name="line-113"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>verbose</span>        <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>Bool</span>
<a name="line-114"></a>      <span class='hs-comment'>-- ^ Whether to write server status updates to stderr</span>
<a name="line-115"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>errorHandler</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>SomeException</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span>
<a name="line-116"></a>      <span class='hs-comment'>-- ^ A MonadSnap action to handle 500 errors</span>
<a name="line-117"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>defaultTimeout</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>Int</span>
<a name="line-118"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>other</span>          <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-varid'>a</span>
<a name="line-119"></a>      <span class='hs-comment'>-- ^ This is for any other state needed to initialize a custom server</span>
<a name="line-120"></a>    <span class='hs-layout'>}</span>
<a name="line-121"></a>
<a name="line-122"></a>
<a name="line-123"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-124"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>MonadSnap</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Show</span> <span class='hs-layout'>(</span><span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-125"></a>    <span class='hs-varid'>show</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>=</span> <span class='hs-str'>"Config {"</span> <span class='hs-varop'>++</span> <span class='hs-varid'>concat</span> <span class='hs-layout'>(</span><span class='hs-varid'>intersperse</span> <span class='hs-str'>", "</span> <span class='hs-varop'>$</span> <span class='hs-varid'>filter</span> <span class='hs-layout'>(</span><span class='hs-varop'>/=</span><span class='hs-str'>""</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varop'>$</span><span class='hs-varid'>c</span><span class='hs-layout'>)</span>
<a name="line-126"></a>        <span class='hs-keyglyph'>[</span> <span class='hs-varid'>showM</span> <span class='hs-str'>"hostname"</span> <span class='hs-varop'>.</span> <span class='hs-varid'>hostname</span>
<a name="line-127"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>showL</span> <span class='hs-str'>"listen"</span> <span class='hs-varop'>.</span> <span class='hs-varid'>listen</span>
<a name="line-128"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>showM</span> <span class='hs-str'>"accessLog"</span> <span class='hs-varop'>.</span> <span class='hs-varid'>accessLog</span>
<a name="line-129"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>showM</span> <span class='hs-str'>"errorLog"</span> <span class='hs-varop'>.</span> <span class='hs-varid'>errorLog</span>
<a name="line-130"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>showM</span> <span class='hs-str'>"locale"</span> <span class='hs-varop'>.</span> <span class='hs-varid'>locale</span>
<a name="line-131"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>showM</span> <span class='hs-str'>"backend"</span> <span class='hs-varop'>.</span> <span class='hs-varid'>backend</span>
<a name="line-132"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>showM</span> <span class='hs-str'>"compression"</span> <span class='hs-varop'>.</span> <span class='hs-varid'>compression</span>
<a name="line-133"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>showM</span> <span class='hs-str'>"verbose"</span> <span class='hs-varop'>.</span> <span class='hs-varid'>verbose</span>
<a name="line-134"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>showM</span> <span class='hs-str'>"errorHandler"</span> <span class='hs-varop'>.</span> <span class='hs-varid'>fmap</span> <span class='hs-layout'>(</span><span class='hs-varid'>const</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span> <span class='hs-varop'>.</span> <span class='hs-varid'>errorHandler</span>
<a name="line-135"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>showM</span> <span class='hs-str'>"defaultTimeout"</span> <span class='hs-varop'>.</span> <span class='hs-varid'>fmap</span> <span class='hs-layout'>(</span><span class='hs-varid'>const</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span> <span class='hs-varop'>.</span> <span class='hs-varid'>defaultTimeout</span>
<a name="line-136"></a>        <span class='hs-keyglyph'>]</span><span class='hs-layout'>)</span> <span class='hs-varop'>++</span> <span class='hs-str'>"}"</span>
<a name="line-137"></a>      <span class='hs-keyword'>where</span>
<a name="line-138"></a>        <span class='hs-varid'>showM</span> <span class='hs-varid'>s</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>maybe</span> <span class='hs-str'>""</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varop'>++</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>s</span> <span class='hs-varop'>++</span> <span class='hs-str'>" = "</span><span class='hs-layout'>)</span> <span class='hs-varop'>.</span> <span class='hs-varid'>show</span><span class='hs-layout'>)</span>
<a name="line-139"></a>        <span class='hs-varid'>showL</span> <span class='hs-varid'>s</span> <span class='hs-varid'>l</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>s</span> <span class='hs-varop'>++</span> <span class='hs-str'>" = "</span> <span class='hs-varop'>++</span> <span class='hs-varid'>show</span> <span class='hs-varid'>l</span>
<a name="line-140"></a>
<a name="line-141"></a>
<a name="line-142"></a><a name="emptyConfig"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-143"></a><span class='hs-comment'>-- | Returns a completely empty 'Config'. Equivalent to 'mempty' from</span>
<a name="line-144"></a><span class='hs-comment'>-- 'Config''s 'Monoid' instance.</span>
<a name="line-145"></a><span class='hs-definition'>emptyConfig</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>MonadSnap</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span>
<a name="line-146"></a><span class='hs-definition'>emptyConfig</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mempty</span>
<a name="line-147"></a>
<a name="line-148"></a>
<a name="line-149"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-150"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>MonadSnap</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Monoid</span> <span class='hs-layout'>(</span><span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-151"></a>    <span class='hs-varid'>mempty</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Config</span>
<a name="line-152"></a>        <span class='hs-layout'>{</span> <span class='hs-varid'>hostname</span>       <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-153"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>listen</span>         <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span>
<a name="line-154"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>accessLog</span>      <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-155"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>errorLog</span>       <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-156"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>locale</span>         <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-157"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>backend</span>        <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-158"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>compression</span>    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-159"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>verbose</span>        <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-160"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>errorHandler</span>   <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-161"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>defaultTimeout</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-162"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>other</span>          <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-163"></a>        <span class='hs-layout'>}</span>
<a name="line-164"></a>
<a name="line-165"></a>    <span class='hs-varid'>a</span> <span class='hs-varop'>`mappend`</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Config</span>
<a name="line-166"></a>        <span class='hs-layout'>{</span> <span class='hs-varid'>hostname</span>       <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>hostname</span>       <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-varop'>`mplus`</span> <span class='hs-layout'>(</span><span class='hs-varid'>hostname</span>       <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-167"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>listen</span>         <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>listen</span>         <span class='hs-varid'>b</span><span class='hs-layout'>)</span>   <span class='hs-varop'>++</span>    <span class='hs-layout'>(</span><span class='hs-varid'>listen</span>         <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-168"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>accessLog</span>      <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>accessLog</span>      <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-varop'>`mplus`</span> <span class='hs-layout'>(</span><span class='hs-varid'>accessLog</span>      <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-169"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>errorLog</span>       <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>errorLog</span>       <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-varop'>`mplus`</span> <span class='hs-layout'>(</span><span class='hs-varid'>errorLog</span>       <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-170"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>locale</span>         <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>locale</span>         <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-varop'>`mplus`</span> <span class='hs-layout'>(</span><span class='hs-varid'>locale</span>         <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-171"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>backend</span>        <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>backend</span>        <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-varop'>`mplus`</span> <span class='hs-layout'>(</span><span class='hs-varid'>backend</span>        <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-172"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>compression</span>    <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>compression</span>    <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-varop'>`mplus`</span> <span class='hs-layout'>(</span><span class='hs-varid'>compression</span>    <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-173"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>verbose</span>        <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>verbose</span>        <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-varop'>`mplus`</span> <span class='hs-layout'>(</span><span class='hs-varid'>verbose</span>        <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-174"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>errorHandler</span>   <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>errorHandler</span>   <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-varop'>`mplus`</span> <span class='hs-layout'>(</span><span class='hs-varid'>errorHandler</span>   <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-175"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>defaultTimeout</span> <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>defaultTimeout</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-varop'>`mplus`</span> <span class='hs-layout'>(</span><span class='hs-varid'>defaultTimeout</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-176"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>other</span>          <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>other</span>          <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-varop'>`mplus`</span> <span class='hs-layout'>(</span><span class='hs-varid'>other</span>          <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-177"></a>        <span class='hs-layout'>}</span>
<a name="line-178"></a>
<a name="line-179"></a>
<a name="line-180"></a><a name="defaultConfig"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-181"></a><span class='hs-comment'>-- | These are the default values for all the fields in 'Config'.</span>
<a name="line-182"></a><span class='hs-comment'>--</span>
<a name="line-183"></a><span class='hs-comment'>-- &gt; hostname     = "localhost"</span>
<a name="line-184"></a><span class='hs-comment'>-- &gt; listen       = []</span>
<a name="line-185"></a><span class='hs-comment'>-- &gt; accessLog    = "log/access.log"</span>
<a name="line-186"></a><span class='hs-comment'>-- &gt; errorLog     = "log/error.log"</span>
<a name="line-187"></a><span class='hs-comment'>-- &gt; locale       = "en_US"</span>
<a name="line-188"></a><span class='hs-comment'>-- &gt; backend      = Nothing (the backend is selected based on compile options)</span>
<a name="line-189"></a><span class='hs-comment'>-- &gt; compression  = True</span>
<a name="line-190"></a><span class='hs-comment'>-- &gt; verbose      = True</span>
<a name="line-191"></a><span class='hs-comment'>-- &gt; errorHandler = prints the error message</span>
<a name="line-192"></a><span class='hs-comment'>--</span>
<a name="line-193"></a><span class='hs-definition'>defaultConfig</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>MonadSnap</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span>
<a name="line-194"></a><span class='hs-definition'>defaultConfig</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Config</span>
<a name="line-195"></a>    <span class='hs-layout'>{</span> <span class='hs-varid'>hostname</span>     <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-str'>"localhost"</span>
<a name="line-196"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>listen</span>       <span class='hs-keyglyph'>=</span> <span class='hs-conid'>[]</span>
<a name="line-197"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>accessLog</span>    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Just</span> <span class='hs-str'>"log/access.log"</span>
<a name="line-198"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>errorLog</span>     <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Just</span> <span class='hs-str'>"log/error.log"</span>
<a name="line-199"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>locale</span>       <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-str'>"en_US"</span>
<a name="line-200"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>backend</span>      <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-201"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>compression</span>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-conid'>True</span>
<a name="line-202"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>verbose</span>      <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-conid'>True</span>
<a name="line-203"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>errorHandler</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>e</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyword'>do</span>
<a name="line-204"></a>        <span class='hs-keyword'>let</span> <span class='hs-varid'>err</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>U</span><span class='hs-varop'>.</span><span class='hs-varid'>fromString</span> <span class='hs-varop'>$</span> <span class='hs-varid'>show</span> <span class='hs-varid'>e</span>
<a name="line-205"></a>            <span class='hs-varid'>msg</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mappend</span> <span class='hs-str'>"A web handler threw an exception. Details:\n"</span> <span class='hs-varid'>err</span>
<a name="line-206"></a>        <span class='hs-varid'>finishWith</span> <span class='hs-varop'>$</span> <span class='hs-varid'>setContentType</span> <span class='hs-str'>"text/plain; charset=utf-8"</span>
<a name="line-207"></a>                   <span class='hs-varop'>.</span> <span class='hs-varid'>setContentLength</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromIntegral</span> <span class='hs-varop'>$</span> <span class='hs-conid'>B</span><span class='hs-varop'>.</span><span class='hs-varid'>length</span> <span class='hs-varid'>msg</span><span class='hs-layout'>)</span>
<a name="line-208"></a>                   <span class='hs-varop'>.</span> <span class='hs-varid'>setResponseStatus</span> <span class='hs-num'>500</span> <span class='hs-str'>"Internal Server Error"</span>
<a name="line-209"></a>                   <span class='hs-varop'>.</span> <span class='hs-varid'>modifyResponseBody</span>
<a name="line-210"></a>                         <span class='hs-layout'>(</span><span class='hs-varop'>&gt;==&gt;</span> <span class='hs-varid'>enumBuilder</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromByteString</span> <span class='hs-varid'>msg</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-211"></a>                   <span class='hs-varop'>$</span> <span class='hs-varid'>emptyResponse</span>
<a name="line-212"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>defaultTimeout</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-num'>60</span>
<a name="line-213"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>other</span>        <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-214"></a>    <span class='hs-layout'>}</span>
<a name="line-215"></a>
<a name="line-216"></a>
<a name="line-217"></a><a name="completeConfig"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-218"></a><span class='hs-comment'>-- | Completes a partial 'Config' by filling in the unspecified values with</span>
<a name="line-219"></a><span class='hs-comment'>-- the default values from 'defaultConfig'.  Also, if no listeners are</span>
<a name="line-220"></a><span class='hs-comment'>-- specified, adds a http listener on 0.0.0.0:8000</span>
<a name="line-221"></a><span class='hs-definition'>completeConfig</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>MonadSnap</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span>
<a name="line-222"></a><span class='hs-definition'>completeConfig</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>listen</span> <span class='hs-varid'>c'</span> <span class='hs-keyword'>of</span>
<a name="line-223"></a>                    <span class='hs-conid'>[]</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>addListen</span> <span class='hs-layout'>(</span><span class='hs-conid'>ListenHttp</span> <span class='hs-str'>"0.0.0.0"</span> <span class='hs-num'>8000</span><span class='hs-layout'>)</span> <span class='hs-varid'>c'</span>
<a name="line-224"></a>                    <span class='hs-keyword'>_</span>  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>c'</span>
<a name="line-225"></a>    <span class='hs-keyword'>where</span> <span class='hs-varid'>c'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mappend</span> <span class='hs-varid'>defaultConfig</span> <span class='hs-varid'>c</span>
<a name="line-226"></a>
<a name="line-227"></a>
<a name="line-228"></a><a name="OptionData"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-229"></a><a name="OptionData"></a><span class='hs-comment'>-- | A data structure used during command-line option parsing</span>
<a name="line-230"></a><a name="OptionData"></a><span class='hs-comment'>--</span>
<a name="line-231"></a><a name="OptionData"></a><span class='hs-comment'>-- The Config data type allows a list of listen ports, but the command line</span>
<a name="line-232"></a><a name="OptionData"></a><span class='hs-comment'>-- options only allow one http and one https listener.  This data structure</span>
<a name="line-233"></a><a name="OptionData"></a><span class='hs-comment'>-- is used during option parsing</span>
<a name="line-234"></a><a name="OptionData"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>MonadSnap</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>OptionData</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>OptionData</span>
<a name="line-235"></a>    <span class='hs-layout'>{</span> <span class='hs-varid'>config</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span>
<a name="line-236"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>bind</span>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>ByteString</span>
<a name="line-237"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>port</span>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>Int</span>
<a name="line-238"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>sslbind</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>ByteString</span>
<a name="line-239"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>sslport</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>Int</span>
<a name="line-240"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>sslcert</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>FilePath</span>
<a name="line-241"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>sslkey</span>  <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>FilePath</span>
<a name="line-242"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>tout</span>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>Int</span>
<a name="line-243"></a>    <span class='hs-layout'>}</span>
<a name="line-244"></a>
<a name="line-245"></a>
<a name="line-246"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-247"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>MonadSnap</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Monoid</span> <span class='hs-layout'>(</span><span class='hs-conid'>OptionData</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-248"></a>    <span class='hs-varid'>mempty</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>OptionData</span>
<a name="line-249"></a>        <span class='hs-layout'>{</span> <span class='hs-varid'>config</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mempty</span>
<a name="line-250"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>bind</span>    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-251"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>port</span>    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-252"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>sslbind</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-253"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>sslport</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-254"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>sslcert</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-255"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>sslkey</span>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-256"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>tout</span>    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-257"></a>        <span class='hs-layout'>}</span>
<a name="line-258"></a>
<a name="line-259"></a>    <span class='hs-varid'>a</span> <span class='hs-varop'>`mappend`</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>OptionData</span>
<a name="line-260"></a>        <span class='hs-layout'>{</span> <span class='hs-varid'>config</span>       <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>config</span>       <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-varop'>`mappend`</span> <span class='hs-layout'>(</span><span class='hs-varid'>config</span>       <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-261"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>bind</span>         <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>bind</span>         <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-varop'>`mplus`</span>   <span class='hs-layout'>(</span><span class='hs-varid'>bind</span>         <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-262"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>port</span>         <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>port</span>         <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-varop'>`mplus`</span>   <span class='hs-layout'>(</span><span class='hs-varid'>port</span>         <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-263"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>sslbind</span>      <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>sslbind</span>      <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-varop'>`mplus`</span>   <span class='hs-layout'>(</span><span class='hs-varid'>sslbind</span>      <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-264"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>sslport</span>      <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>sslport</span>      <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-varop'>`mplus`</span>   <span class='hs-layout'>(</span><span class='hs-varid'>sslport</span>      <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-265"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>sslcert</span>      <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>sslcert</span>      <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-varop'>`mplus`</span>   <span class='hs-layout'>(</span><span class='hs-varid'>sslcert</span>      <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-266"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>sslkey</span>       <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>sslkey</span>       <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-varop'>`mplus`</span>   <span class='hs-layout'>(</span><span class='hs-varid'>sslkey</span>       <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-267"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>tout</span>         <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>tout</span>         <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-varop'>`mplus`</span>   <span class='hs-layout'>(</span><span class='hs-varid'>tout</span>         <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-268"></a>        <span class='hs-layout'>}</span>
<a name="line-269"></a>
<a name="line-270"></a>
<a name="line-271"></a><a name="defaultOptions"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-272"></a><span class='hs-comment'>-- | These are the default values for the options</span>
<a name="line-273"></a><span class='hs-definition'>defaultOptions</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>MonadSnap</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>OptionData</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span>
<a name="line-274"></a><span class='hs-definition'>defaultOptions</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>OptionData</span>
<a name="line-275"></a>    <span class='hs-layout'>{</span> <span class='hs-varid'>config</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>defaultConfig</span>
<a name="line-276"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>bind</span>    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-str'>"0.0.0.0"</span>
<a name="line-277"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>port</span>    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-num'>8000</span>
<a name="line-278"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>sslbind</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-str'>"0.0.0.0"</span>
<a name="line-279"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>sslport</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-280"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>sslcert</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-str'>"cert.pem"</span>
<a name="line-281"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>sslkey</span>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-str'>"key.pem"</span>
<a name="line-282"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>tout</span>    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-num'>60</span>
<a name="line-283"></a>    <span class='hs-layout'>}</span>
<a name="line-284"></a>
<a name="line-285"></a>
<a name="line-286"></a><a name="optionsToConfig"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-287"></a><span class='hs-comment'>-- | Convert options to config</span>
<a name="line-288"></a><span class='hs-definition'>optionsToConfig</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>MonadSnap</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>OptionData</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span>
<a name="line-289"></a><span class='hs-definition'>optionsToConfig</span> <span class='hs-varid'>o</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mconcat</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>config</span> <span class='hs-varid'>o</span><span class='hs-keyglyph'>]</span> <span class='hs-varop'>++</span> <span class='hs-varid'>http</span> <span class='hs-varop'>++</span> <span class='hs-varid'>https</span> <span class='hs-varop'>++</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>tmOut</span><span class='hs-keyglyph'>]</span>
<a name="line-290"></a>    <span class='hs-keyword'>where</span> <span class='hs-varid'>lhttp</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>maybe2</span> <span class='hs-conid'>[]</span> <span class='hs-conid'>ListenHttp</span>  <span class='hs-layout'>(</span><span class='hs-varid'>bind</span> <span class='hs-varid'>o</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-varid'>port</span> <span class='hs-varid'>o</span><span class='hs-layout'>)</span>
<a name="line-291"></a>          <span class='hs-varid'>lhttps</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>maybe4</span> <span class='hs-conid'>[]</span> <span class='hs-conid'>ListenHttps</span> <span class='hs-layout'>(</span><span class='hs-varid'>sslbind</span> <span class='hs-varid'>o</span><span class='hs-layout'>)</span>
<a name="line-292"></a>                                         <span class='hs-layout'>(</span><span class='hs-varid'>sslport</span> <span class='hs-varid'>o</span><span class='hs-layout'>)</span>
<a name="line-293"></a>                                         <span class='hs-layout'>(</span><span class='hs-varid'>sslcert</span> <span class='hs-varid'>o</span><span class='hs-layout'>)</span>
<a name="line-294"></a>                                         <span class='hs-layout'>(</span><span class='hs-varid'>sslkey</span>  <span class='hs-varid'>o</span><span class='hs-layout'>)</span>
<a name="line-295"></a>          <span class='hs-varid'>http</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varid'>flip</span> <span class='hs-varid'>addListen</span> <span class='hs-varid'>mempty</span><span class='hs-layout'>)</span> <span class='hs-varid'>lhttp</span>
<a name="line-296"></a>          <span class='hs-varid'>https</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varid'>flip</span> <span class='hs-varid'>addListen</span> <span class='hs-varid'>mempty</span><span class='hs-layout'>)</span> <span class='hs-varid'>lhttps</span>
<a name="line-297"></a>
<a name="line-298"></a>          <span class='hs-varid'>maybe2</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>f</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span><span class='hs-keyglyph'>]</span>
<a name="line-299"></a>          <span class='hs-varid'>maybe2</span> <span class='hs-varid'>d</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span>        <span class='hs-keyword'>_</span>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>d</span>
<a name="line-300"></a>          <span class='hs-varid'>maybe4</span> <span class='hs-keyword'>_</span> <span class='hs-varid'>f</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-varid'>b</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-varid'>d</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>f</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span> <span class='hs-varid'>c</span> <span class='hs-varid'>d</span><span class='hs-keyglyph'>]</span>
<a name="line-301"></a>          <span class='hs-varid'>maybe4</span> <span class='hs-varid'>d</span> <span class='hs-keyword'>_</span> <span class='hs-keyword'>_</span>        <span class='hs-keyword'>_</span>        <span class='hs-keyword'>_</span>        <span class='hs-keyword'>_</span>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>d</span>
<a name="line-302"></a>
<a name="line-303"></a>          <span class='hs-varid'>tmOut</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>maybe</span> <span class='hs-varid'>mempty</span>
<a name="line-304"></a>                        <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>t</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>mempty</span> <span class='hs-layout'>{</span> <span class='hs-varid'>defaultTimeout</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>t</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-305"></a>                        <span class='hs-layout'>(</span><span class='hs-varid'>tout</span> <span class='hs-varid'>o</span><span class='hs-layout'>)</span>
<a name="line-306"></a>
<a name="line-307"></a><a name="configToOptions"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-308"></a><span class='hs-comment'>-- | Convert config to options</span>
<a name="line-309"></a><span class='hs-definition'>configToOptions</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>MonadSnap</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>OptionData</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span>
<a name="line-310"></a><span class='hs-definition'>configToOptions</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>OptionData</span>
<a name="line-311"></a>    <span class='hs-layout'>{</span> <span class='hs-varid'>config</span>  <span class='hs-keyglyph'>=</span> <span class='hs-varid'>c</span>
<a name="line-312"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>bind</span>    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-313"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>port</span>    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-314"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>sslbind</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-315"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>sslport</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-316"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>sslcert</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-317"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>sslkey</span>  <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-318"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>tout</span>    <span class='hs-keyglyph'>=</span> <span class='hs-layout'>(</span><span class='hs-varid'>defaultTimeout</span> <span class='hs-varid'>c</span><span class='hs-layout'>)</span>
<a name="line-319"></a>    <span class='hs-layout'>}</span>
<a name="line-320"></a>
<a name="line-321"></a>
<a name="line-322"></a><a name="options"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-323"></a><span class='hs-comment'>-- | A description of the command-line options accepted by</span>
<a name="line-324"></a><span class='hs-comment'>-- 'commandLineConfig'.</span>
<a name="line-325"></a><span class='hs-comment'>--</span>
<a name="line-326"></a><span class='hs-comment'>-- The 'OptionData' parameter is just for specifying any default values which</span>
<a name="line-327"></a><span class='hs-comment'>-- are to override those in 'defaultOptions'. This is so the usage message can</span>
<a name="line-328"></a><span class='hs-comment'>-- accurately inform the user what the default values for the options are. In</span>
<a name="line-329"></a><span class='hs-comment'>-- most cases, you will probably just end up passing 'mempty' for this</span>
<a name="line-330"></a><span class='hs-comment'>-- parameter.</span>
<a name="line-331"></a><span class='hs-comment'>--</span>
<a name="line-332"></a><span class='hs-comment'>-- The return type is a list of options describing @'Maybe' ('OptionData' m)@</span>
<a name="line-333"></a><span class='hs-comment'>-- as opposed to @'OptionData' m@, because if the @--help@ option is given,</span>
<a name="line-334"></a><span class='hs-comment'>-- the set of command-line options no longer describe a config, but an action</span>
<a name="line-335"></a><span class='hs-comment'>-- (printing out the usage message).</span>
<a name="line-336"></a><span class='hs-definition'>options</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>MonadSnap</span> <span class='hs-varid'>m</span>
<a name="line-337"></a>        <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>OptionData</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span>
<a name="line-338"></a>        <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>OptDescr</span> <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>OptionData</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-339"></a><span class='hs-definition'>options</span> <span class='hs-varid'>defaults</span> <span class='hs-keyglyph'>=</span>
<a name="line-340"></a>    <span class='hs-keyglyph'>[</span> <span class='hs-conid'>Option</span> <span class='hs-conid'>[]</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"hostname"</span><span class='hs-keyglyph'>]</span>
<a name="line-341"></a>             <span class='hs-layout'>(</span><span class='hs-conid'>ReqArg</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-varop'>.</span> <span class='hs-varid'>setConfig</span> <span class='hs-varid'>setHostname</span> <span class='hs-varop'>.</span> <span class='hs-conid'>U</span><span class='hs-varop'>.</span><span class='hs-varid'>fromString</span><span class='hs-layout'>)</span> <span class='hs-str'>"NAME"</span><span class='hs-layout'>)</span>
<a name="line-342"></a>             <span class='hs-varop'>$</span> <span class='hs-str'>"local hostname"</span> <span class='hs-varop'>++</span> <span class='hs-varid'>defaultC</span> <span class='hs-varid'>getHostname</span>
<a name="line-343"></a>    <span class='hs-layout'>,</span> <span class='hs-conid'>Option</span> <span class='hs-keyglyph'>[</span><span class='hs-chr'>'b'</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"address"</span><span class='hs-keyglyph'>]</span>
<a name="line-344"></a>             <span class='hs-layout'>(</span><span class='hs-conid'>ReqArg</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-varid'>mempty</span> <span class='hs-layout'>{</span> <span class='hs-varid'>bind</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-conid'>U</span><span class='hs-varop'>.</span><span class='hs-varid'>fromString</span> <span class='hs-varid'>s</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-345"></a>                     <span class='hs-str'>"ADDRESS"</span><span class='hs-layout'>)</span>
<a name="line-346"></a>             <span class='hs-varop'>$</span> <span class='hs-str'>"address to bind to"</span> <span class='hs-varop'>++</span> <span class='hs-varid'>defaultO</span> <span class='hs-varid'>bind</span>
<a name="line-347"></a>    <span class='hs-layout'>,</span> <span class='hs-conid'>Option</span> <span class='hs-keyglyph'>[</span><span class='hs-chr'>'p'</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"port"</span><span class='hs-keyglyph'>]</span>
<a name="line-348"></a>             <span class='hs-layout'>(</span><span class='hs-conid'>ReqArg</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-varid'>mempty</span> <span class='hs-layout'>{</span> <span class='hs-varid'>port</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-varid'>read</span> <span class='hs-varid'>s</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-str'>"PORT"</span><span class='hs-layout'>)</span>
<a name="line-349"></a>             <span class='hs-varop'>$</span> <span class='hs-str'>"port to listen on"</span> <span class='hs-varop'>++</span> <span class='hs-varid'>defaultO</span> <span class='hs-varid'>port</span>
<a name="line-350"></a>    <span class='hs-layout'>,</span> <span class='hs-conid'>Option</span> <span class='hs-conid'>[]</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"ssl-address"</span><span class='hs-keyglyph'>]</span>
<a name="line-351"></a>             <span class='hs-layout'>(</span><span class='hs-conid'>ReqArg</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-varid'>mempty</span> <span class='hs-layout'>{</span> <span class='hs-varid'>sslbind</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-conid'>U</span><span class='hs-varop'>.</span><span class='hs-varid'>fromString</span> <span class='hs-varid'>s</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-352"></a>                     <span class='hs-str'>"ADDRESS"</span><span class='hs-layout'>)</span>
<a name="line-353"></a>             <span class='hs-varop'>$</span> <span class='hs-str'>"ssl address to bind to"</span> <span class='hs-varop'>++</span> <span class='hs-varid'>defaultO</span> <span class='hs-varid'>sslbind</span>
<a name="line-354"></a>    <span class='hs-layout'>,</span> <span class='hs-conid'>Option</span> <span class='hs-conid'>[]</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"ssl-port"</span><span class='hs-keyglyph'>]</span>
<a name="line-355"></a>             <span class='hs-layout'>(</span><span class='hs-conid'>ReqArg</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-varid'>mempty</span> <span class='hs-layout'>{</span> <span class='hs-varid'>sslport</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-varid'>read</span> <span class='hs-varid'>s</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-str'>"PORT"</span><span class='hs-layout'>)</span>
<a name="line-356"></a>             <span class='hs-varop'>$</span> <span class='hs-str'>"ssl port to listen on"</span> <span class='hs-varop'>++</span> <span class='hs-varid'>defaultO</span> <span class='hs-varid'>sslport</span>
<a name="line-357"></a>    <span class='hs-layout'>,</span> <span class='hs-conid'>Option</span> <span class='hs-conid'>[]</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"ssl-cert"</span><span class='hs-keyglyph'>]</span>
<a name="line-358"></a>             <span class='hs-layout'>(</span><span class='hs-conid'>ReqArg</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-varid'>mempty</span> <span class='hs-layout'>{</span> <span class='hs-varid'>sslcert</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-varid'>read</span> <span class='hs-varid'>s</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-str'>"PATH"</span><span class='hs-layout'>)</span>
<a name="line-359"></a>             <span class='hs-varop'>$</span> <span class='hs-str'>"path to ssl certificate in PEM format"</span> <span class='hs-varop'>++</span> <span class='hs-varid'>defaultO</span> <span class='hs-varid'>sslcert</span>
<a name="line-360"></a>    <span class='hs-layout'>,</span> <span class='hs-conid'>Option</span> <span class='hs-conid'>[]</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"ssl-key"</span><span class='hs-keyglyph'>]</span>
<a name="line-361"></a>             <span class='hs-layout'>(</span><span class='hs-conid'>ReqArg</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-varid'>mempty</span> <span class='hs-layout'>{</span> <span class='hs-varid'>sslkey</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-varid'>read</span> <span class='hs-varid'>s</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-str'>"PATH"</span><span class='hs-layout'>)</span>
<a name="line-362"></a>             <span class='hs-varop'>$</span> <span class='hs-str'>"path to ssl private key in PEM format"</span> <span class='hs-varop'>++</span> <span class='hs-varid'>defaultO</span> <span class='hs-varid'>sslkey</span>
<a name="line-363"></a>    <span class='hs-layout'>,</span> <span class='hs-conid'>Option</span> <span class='hs-conid'>[]</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"access-log"</span><span class='hs-keyglyph'>]</span>
<a name="line-364"></a>             <span class='hs-layout'>(</span><span class='hs-conid'>ReqArg</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-varop'>.</span> <span class='hs-varid'>setConfig</span> <span class='hs-varid'>setAccessLog</span> <span class='hs-varop'>.</span> <span class='hs-conid'>Just</span><span class='hs-layout'>)</span> <span class='hs-str'>"PATH"</span><span class='hs-layout'>)</span>
<a name="line-365"></a>             <span class='hs-varop'>$</span> <span class='hs-str'>"access log"</span> <span class='hs-varop'>++</span> <span class='hs-layout'>(</span><span class='hs-varid'>defaultC</span> <span class='hs-varop'>$</span> <span class='hs-varid'>join</span> <span class='hs-varop'>.</span> <span class='hs-varid'>getAccessLog</span><span class='hs-layout'>)</span>
<a name="line-366"></a>    <span class='hs-layout'>,</span> <span class='hs-conid'>Option</span> <span class='hs-conid'>[]</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"error-log"</span><span class='hs-keyglyph'>]</span>
<a name="line-367"></a>             <span class='hs-layout'>(</span><span class='hs-conid'>ReqArg</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-varop'>.</span> <span class='hs-varid'>setConfig</span> <span class='hs-varid'>setErrorLog</span> <span class='hs-varop'>.</span> <span class='hs-conid'>Just</span><span class='hs-layout'>)</span> <span class='hs-str'>"PATH"</span><span class='hs-layout'>)</span>
<a name="line-368"></a>             <span class='hs-varop'>$</span> <span class='hs-str'>"error log"</span> <span class='hs-varop'>++</span> <span class='hs-layout'>(</span><span class='hs-varid'>defaultC</span> <span class='hs-varop'>$</span> <span class='hs-varid'>join</span> <span class='hs-varop'>.</span> <span class='hs-varid'>getErrorLog</span><span class='hs-layout'>)</span>
<a name="line-369"></a>    <span class='hs-layout'>,</span> <span class='hs-conid'>Option</span> <span class='hs-conid'>[]</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"no-access-log"</span><span class='hs-keyglyph'>]</span>
<a name="line-370"></a>             <span class='hs-layout'>(</span><span class='hs-conid'>NoArg</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-varid'>setConfig</span> <span class='hs-varid'>setErrorLog</span> <span class='hs-conid'>Nothing</span><span class='hs-layout'>)</span>
<a name="line-371"></a>             <span class='hs-varop'>$</span> <span class='hs-str'>"don't have an access log"</span>
<a name="line-372"></a>    <span class='hs-layout'>,</span> <span class='hs-conid'>Option</span> <span class='hs-conid'>[]</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"no-error-log"</span><span class='hs-keyglyph'>]</span>
<a name="line-373"></a>             <span class='hs-layout'>(</span><span class='hs-conid'>NoArg</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-varid'>setConfig</span> <span class='hs-varid'>setAccessLog</span> <span class='hs-conid'>Nothing</span><span class='hs-layout'>)</span>
<a name="line-374"></a>             <span class='hs-varop'>$</span> <span class='hs-str'>"don't have an error log"</span>
<a name="line-375"></a>    <span class='hs-layout'>,</span> <span class='hs-conid'>Option</span> <span class='hs-keyglyph'>[</span><span class='hs-chr'>'c'</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"compression"</span><span class='hs-keyglyph'>]</span>
<a name="line-376"></a>             <span class='hs-layout'>(</span><span class='hs-conid'>NoArg</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-varid'>setConfig</span> <span class='hs-varid'>setCompression</span> <span class='hs-conid'>True</span><span class='hs-layout'>)</span>
<a name="line-377"></a>             <span class='hs-varop'>$</span> <span class='hs-str'>"use gzip compression on responses"</span>
<a name="line-378"></a>    <span class='hs-layout'>,</span> <span class='hs-conid'>Option</span> <span class='hs-keyglyph'>[</span><span class='hs-chr'>'t'</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"timeout"</span><span class='hs-keyglyph'>]</span>
<a name="line-379"></a>             <span class='hs-layout'>(</span><span class='hs-conid'>ReqArg</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>t</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-varid'>mempty</span> <span class='hs-layout'>{</span> <span class='hs-varid'>tout</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-varid'>read</span> <span class='hs-varid'>t</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-str'>"SECS"</span><span class='hs-layout'>)</span>
<a name="line-380"></a>             <span class='hs-varop'>$</span> <span class='hs-str'>"set default timeout in seconds"</span>
<a name="line-381"></a>    <span class='hs-layout'>,</span> <span class='hs-conid'>Option</span> <span class='hs-conid'>[]</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"no-compression"</span><span class='hs-keyglyph'>]</span>
<a name="line-382"></a>             <span class='hs-layout'>(</span><span class='hs-conid'>NoArg</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-varid'>setConfig</span> <span class='hs-varid'>setCompression</span> <span class='hs-conid'>False</span><span class='hs-layout'>)</span>
<a name="line-383"></a>             <span class='hs-varop'>$</span> <span class='hs-str'>"serve responses uncompressed"</span>
<a name="line-384"></a>    <span class='hs-layout'>,</span> <span class='hs-conid'>Option</span> <span class='hs-keyglyph'>[</span><span class='hs-chr'>'v'</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"verbose"</span><span class='hs-keyglyph'>]</span>
<a name="line-385"></a>             <span class='hs-layout'>(</span><span class='hs-conid'>NoArg</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-varid'>setConfig</span> <span class='hs-varid'>setVerbose</span> <span class='hs-conid'>True</span><span class='hs-layout'>)</span>
<a name="line-386"></a>             <span class='hs-varop'>$</span> <span class='hs-str'>"print server status updates to stderr"</span>
<a name="line-387"></a>    <span class='hs-layout'>,</span> <span class='hs-conid'>Option</span> <span class='hs-keyglyph'>[</span><span class='hs-chr'>'q'</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"quiet"</span><span class='hs-keyglyph'>]</span>
<a name="line-388"></a>             <span class='hs-layout'>(</span><span class='hs-conid'>NoArg</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-varid'>setConfig</span> <span class='hs-varid'>setVerbose</span> <span class='hs-conid'>False</span><span class='hs-layout'>)</span>
<a name="line-389"></a>             <span class='hs-varop'>$</span> <span class='hs-str'>"do not print anything to stderr"</span>
<a name="line-390"></a>    <span class='hs-layout'>,</span> <span class='hs-conid'>Option</span> <span class='hs-keyglyph'>[</span><span class='hs-chr'>'h'</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"help"</span><span class='hs-keyglyph'>]</span>
<a name="line-391"></a>             <span class='hs-layout'>(</span><span class='hs-conid'>NoArg</span> <span class='hs-conid'>Nothing</span><span class='hs-layout'>)</span>
<a name="line-392"></a>             <span class='hs-varop'>$</span> <span class='hs-str'>"display this help and exit"</span>
<a name="line-393"></a>    <span class='hs-keyglyph'>]</span>
<a name="line-394"></a>  <span class='hs-keyword'>where</span>
<a name="line-395"></a>    <span class='hs-varid'>setConfig</span> <span class='hs-varid'>f</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>configToOptions</span> <span class='hs-varop'>$</span> <span class='hs-varid'>f</span> <span class='hs-varid'>c</span> <span class='hs-varid'>mempty</span>
<a name="line-396"></a>    <span class='hs-varid'>conf</span>          <span class='hs-keyglyph'>=</span> <span class='hs-varid'>completeConfig</span> <span class='hs-varop'>$</span> <span class='hs-varid'>config</span> <span class='hs-varid'>defaults</span>
<a name="line-397"></a>    <span class='hs-varid'>opts</span>          <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mappend</span> <span class='hs-varid'>defaultOptions</span> <span class='hs-varid'>defaults</span>
<a name="line-398"></a>    <span class='hs-varid'>defaultC</span> <span class='hs-varid'>f</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>maybe</span> <span class='hs-str'>""</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-str'>", default "</span> <span class='hs-varop'>++</span><span class='hs-layout'>)</span> <span class='hs-varop'>.</span> <span class='hs-varid'>show</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-varid'>f</span> <span class='hs-varid'>conf</span>
<a name="line-399"></a>    <span class='hs-varid'>defaultO</span> <span class='hs-varid'>f</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>maybe</span> <span class='hs-str'>", default off"</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-str'>", default "</span> <span class='hs-varop'>++</span><span class='hs-layout'>)</span> <span class='hs-varop'>.</span> <span class='hs-varid'>show</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-varid'>f</span> <span class='hs-varid'>opts</span>
<a name="line-400"></a>
<a name="line-401"></a>
<a name="line-402"></a><a name="commandLineConfig"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-403"></a><span class='hs-comment'>-- | This returns a 'Config' gotten from parsing the options specified on the</span>
<a name="line-404"></a><span class='hs-comment'>-- command-line.</span>
<a name="line-405"></a><span class='hs-comment'>--</span>
<a name="line-406"></a><span class='hs-comment'>-- The 'Config' parameter is just for specifying any default values which are</span>
<a name="line-407"></a><span class='hs-comment'>-- to override those in 'defaultConfig'. This is so the usage message can</span>
<a name="line-408"></a><span class='hs-comment'>-- accurately inform the user what the default values for the options are. In</span>
<a name="line-409"></a><span class='hs-comment'>-- most cases, you will probably just end up passing 'mempty' for this</span>
<a name="line-410"></a><span class='hs-comment'>-- parameter.</span>
<a name="line-411"></a><span class='hs-comment'>--</span>
<a name="line-412"></a><span class='hs-comment'>-- On Unix systems, the locale is read from the @LANG@ environment variable.</span>
<a name="line-413"></a><span class='hs-definition'>commandLineConfig</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>MonadSnap</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-layout'>(</span><span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-414"></a><span class='hs-definition'>commandLineConfig</span> <span class='hs-varid'>defaults</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-415"></a>    <span class='hs-varid'>args</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getArgs</span>
<a name="line-416"></a>    <span class='hs-varid'>prog</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getProgName</span>
<a name="line-417"></a>
<a name="line-418"></a>    <span class='hs-varid'>result</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>either</span> <span class='hs-layout'>(</span><span class='hs-varid'>usage</span> <span class='hs-varid'>prog</span><span class='hs-layout'>)</span> <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-keyword'>case</span> <span class='hs-varid'>getOpt</span> <span class='hs-conid'>Permute</span> <span class='hs-varid'>opts</span> <span class='hs-varid'>args</span> <span class='hs-keyword'>of</span>
<a name="line-419"></a>        <span class='hs-layout'>(</span><span class='hs-varid'>f</span><span class='hs-layout'>,</span> <span class='hs-keyword'>_</span><span class='hs-layout'>,</span> <span class='hs-conid'>[]</span>  <span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>Left</span> <span class='hs-conid'>[]</span><span class='hs-layout'>)</span> <span class='hs-conid'>Right</span> <span class='hs-varop'>$</span> <span class='hs-varid'>fmap</span> <span class='hs-varid'>mconcat</span> <span class='hs-varop'>$</span> <span class='hs-varid'>sequence</span> <span class='hs-varid'>f</span>
<a name="line-420"></a>        <span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span> <span class='hs-keyword'>_</span><span class='hs-layout'>,</span> <span class='hs-varid'>errs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Left</span> <span class='hs-varid'>errs</span>
<a name="line-421"></a>
<a name="line-422"></a>    <span class='hs-keyword'>let</span> <span class='hs-varid'>result'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>optionsToConfig</span> <span class='hs-varop'>$</span> <span class='hs-varid'>mappend</span> <span class='hs-varid'>defaultOptions</span> <span class='hs-varid'>result</span>
<a name="line-423"></a>
<a name="line-424"></a><span class='hs-cpp'>#ifndef PORTABLE</span>
<a name="line-425"></a>    <span class='hs-varid'>lang</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getEnv</span> <span class='hs-str'>"LANG"</span>
<a name="line-426"></a>    <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-varid'>mconcat</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>defaults</span><span class='hs-layout'>,</span> <span class='hs-varid'>result'</span><span class='hs-layout'>,</span> <span class='hs-varid'>mempty</span> <span class='hs-layout'>{</span><span class='hs-varid'>locale</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fmap</span> <span class='hs-varid'>upToUtf8</span> <span class='hs-varid'>lang</span><span class='hs-layout'>}</span><span class='hs-keyglyph'>]</span>
<a name="line-427"></a><span class='hs-cpp'>#else</span>
<a name="line-428"></a>    <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-varid'>mconcat</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>defaults</span><span class='hs-layout'>,</span> <span class='hs-varid'>result'</span><span class='hs-keyglyph'>]</span>
<a name="line-429"></a><span class='hs-cpp'>#endif</span>
<a name="line-430"></a>
<a name="line-431"></a>  <span class='hs-keyword'>where</span>
<a name="line-432"></a>    <span class='hs-varid'>opts</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>options</span> <span class='hs-varop'>$</span> <span class='hs-varid'>configToOptions</span> <span class='hs-varid'>defaults</span>
<a name="line-433"></a>    <span class='hs-varid'>usage</span> <span class='hs-varid'>prog</span> <span class='hs-varid'>errs</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-434"></a>        <span class='hs-keyword'>let</span> <span class='hs-varid'>hdr</span> <span class='hs-keyglyph'>=</span> <span class='hs-str'>"Usage:\n  "</span> <span class='hs-varop'>++</span> <span class='hs-varid'>prog</span> <span class='hs-varop'>++</span> <span class='hs-str'>" [OPTION...]\n\nOptions:"</span>
<a name="line-435"></a>        <span class='hs-keyword'>let</span> <span class='hs-varid'>msg</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>concat</span> <span class='hs-varid'>errs</span> <span class='hs-varop'>++</span> <span class='hs-varid'>usageInfo</span> <span class='hs-varid'>hdr</span> <span class='hs-varid'>opts</span>
<a name="line-436"></a>        <span class='hs-varid'>hPutStrLn</span> <span class='hs-varid'>stderr</span> <span class='hs-varid'>msg</span>
<a name="line-437"></a>        <span class='hs-varid'>exitFailure</span>
<a name="line-438"></a>    <span class='hs-varid'>upToUtf8</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>takeWhile</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>c</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>isAlpha</span> <span class='hs-varid'>c</span> <span class='hs-varop'>||</span> <span class='hs-chr'>'_'</span> <span class='hs-varop'>==</span> <span class='hs-varid'>c</span>
<a name="line-439"></a>
<a name="line-440"></a>
<a name="line-441"></a><a name="getHostname"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-442"></a><span class='hs-definition'>getHostname</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>MonadSnap</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>ByteString</span>
<a name="line-443"></a><span class='hs-definition'>getHostname</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hostname</span>
<a name="line-444"></a>
<a name="line-445"></a>
<a name="line-446"></a><a name="getListen"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-447"></a><span class='hs-definition'>getListen</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>MonadSnap</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>ConfigListen</span><span class='hs-keyglyph'>]</span>
<a name="line-448"></a><span class='hs-definition'>getListen</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>listen</span>
<a name="line-449"></a>
<a name="line-450"></a>
<a name="line-451"></a><a name="getAccessLog"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-452"></a><span class='hs-definition'>getAccessLog</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>MonadSnap</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-conid'>FilePath</span><span class='hs-layout'>)</span>
<a name="line-453"></a><span class='hs-definition'>getAccessLog</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>accessLog</span>
<a name="line-454"></a>
<a name="line-455"></a>
<a name="line-456"></a><a name="getErrorLog"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-457"></a><span class='hs-definition'>getErrorLog</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>MonadSnap</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-conid'>FilePath</span><span class='hs-layout'>)</span>
<a name="line-458"></a><span class='hs-definition'>getErrorLog</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>errorLog</span>
<a name="line-459"></a>
<a name="line-460"></a>
<a name="line-461"></a><a name="getLocale"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-462"></a><span class='hs-definition'>getLocale</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>MonadSnap</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>String</span>
<a name="line-463"></a><span class='hs-definition'>getLocale</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>locale</span>
<a name="line-464"></a>
<a name="line-465"></a>
<a name="line-466"></a><a name="getBackend"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-467"></a><span class='hs-definition'>getBackend</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>MonadSnap</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>ConfigBackend</span>
<a name="line-468"></a><span class='hs-definition'>getBackend</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>backend</span>
<a name="line-469"></a>
<a name="line-470"></a><a name="getCompression"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-471"></a><span class='hs-definition'>getCompression</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>MonadSnap</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>Bool</span>
<a name="line-472"></a><span class='hs-definition'>getCompression</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>compression</span>
<a name="line-473"></a>
<a name="line-474"></a>
<a name="line-475"></a><a name="getVerbose"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-476"></a><span class='hs-definition'>getVerbose</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>MonadSnap</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>Bool</span>
<a name="line-477"></a><span class='hs-definition'>getVerbose</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>verbose</span>
<a name="line-478"></a>
<a name="line-479"></a>
<a name="line-480"></a><a name="getErrorHandler"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-481"></a><span class='hs-definition'>getErrorHandler</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>MonadSnap</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>SomeException</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span>
<a name="line-482"></a><span class='hs-definition'>getErrorHandler</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>errorHandler</span>
<a name="line-483"></a>
<a name="line-484"></a>
<a name="line-485"></a><a name="getOther"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-486"></a><span class='hs-definition'>getOther</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>MonadSnap</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-varid'>a</span>
<a name="line-487"></a><span class='hs-definition'>getOther</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>other</span>
<a name="line-488"></a>
<a name="line-489"></a>
<a name="line-490"></a><a name="getDefaultTimeout"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-491"></a><span class='hs-definition'>getDefaultTimeout</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>MonadSnap</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>Int</span>
<a name="line-492"></a><span class='hs-definition'>getDefaultTimeout</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>defaultTimeout</span>
<a name="line-493"></a>
<a name="line-494"></a>
<a name="line-495"></a><a name="setHostname"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-496"></a><span class='hs-definition'>setHostname</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>MonadSnap</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>ByteString</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span>
<a name="line-497"></a><span class='hs-definition'>setHostname</span> <span class='hs-varid'>a</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>m</span> <span class='hs-layout'>{</span><span class='hs-varid'>hostname</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>a</span><span class='hs-layout'>}</span>
<a name="line-498"></a>
<a name="line-499"></a>
<a name="line-500"></a><a name="addListen"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-501"></a><span class='hs-definition'>addListen</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>MonadSnap</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>ConfigListen</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span>
<a name="line-502"></a><span class='hs-definition'>addListen</span> <span class='hs-varid'>a</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>m</span> <span class='hs-layout'>{</span><span class='hs-varid'>listen</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>a</span> <span class='hs-conop'>:</span> <span class='hs-varid'>listen</span> <span class='hs-varid'>m</span><span class='hs-layout'>}</span>
<a name="line-503"></a>
<a name="line-504"></a>
<a name="line-505"></a><a name="setAccessLog"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-506"></a><span class='hs-definition'>setAccessLog</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>MonadSnap</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>FilePath</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span>
<a name="line-507"></a><span class='hs-definition'>setAccessLog</span> <span class='hs-varid'>a</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>m</span> <span class='hs-layout'>{</span><span class='hs-varid'>accessLog</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>a</span><span class='hs-layout'>}</span>
<a name="line-508"></a>
<a name="line-509"></a>
<a name="line-510"></a><a name="setErrorLog"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-511"></a><span class='hs-definition'>setErrorLog</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>MonadSnap</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>FilePath</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span>
<a name="line-512"></a><span class='hs-definition'>setErrorLog</span> <span class='hs-varid'>a</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>m</span> <span class='hs-layout'>{</span><span class='hs-varid'>errorLog</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>a</span><span class='hs-layout'>}</span>
<a name="line-513"></a>
<a name="line-514"></a>
<a name="line-515"></a><a name="setLocale"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-516"></a><span class='hs-definition'>setLocale</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>MonadSnap</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span>
<a name="line-517"></a><span class='hs-definition'>setLocale</span> <span class='hs-varid'>a</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>m</span> <span class='hs-layout'>{</span><span class='hs-varid'>locale</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>a</span><span class='hs-layout'>}</span>
<a name="line-518"></a>
<a name="line-519"></a>
<a name="line-520"></a><a name="setBackend"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-521"></a><span class='hs-definition'>setBackend</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>MonadSnap</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>ConfigBackend</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span>
<a name="line-522"></a><span class='hs-definition'>setBackend</span> <span class='hs-varid'>a</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>m</span> <span class='hs-layout'>{</span> <span class='hs-varid'>backend</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>a</span><span class='hs-layout'>}</span>
<a name="line-523"></a>
<a name="line-524"></a>
<a name="line-525"></a><a name="setCompression"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-526"></a><span class='hs-definition'>setCompression</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>MonadSnap</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Bool</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span>
<a name="line-527"></a><span class='hs-definition'>setCompression</span> <span class='hs-varid'>a</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>m</span> <span class='hs-layout'>{</span><span class='hs-varid'>compression</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>a</span><span class='hs-layout'>}</span>
<a name="line-528"></a>
<a name="line-529"></a>
<a name="line-530"></a><a name="setVerbose"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-531"></a><span class='hs-definition'>setVerbose</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>MonadSnap</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Bool</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span>
<a name="line-532"></a><span class='hs-definition'>setVerbose</span> <span class='hs-varid'>a</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>m</span> <span class='hs-layout'>{</span><span class='hs-varid'>verbose</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>a</span><span class='hs-layout'>}</span>
<a name="line-533"></a>
<a name="line-534"></a>
<a name="line-535"></a><a name="setErrorHandler"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-536"></a><span class='hs-definition'>setErrorHandler</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>MonadSnap</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-layout'>(</span><span class='hs-conid'>SomeException</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span>
<a name="line-537"></a>                <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span>
<a name="line-538"></a><span class='hs-definition'>setErrorHandler</span> <span class='hs-varid'>a</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>m</span> <span class='hs-layout'>{</span><span class='hs-varid'>errorHandler</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>a</span><span class='hs-layout'>}</span>
<a name="line-539"></a>
<a name="line-540"></a>
<a name="line-541"></a><a name="setOther"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-542"></a><span class='hs-definition'>setOther</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>MonadSnap</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span>
<a name="line-543"></a><span class='hs-definition'>setOther</span> <span class='hs-varid'>a</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>m</span> <span class='hs-layout'>{</span><span class='hs-varid'>other</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>a</span><span class='hs-layout'>}</span>
<a name="line-544"></a>
<a name="line-545"></a>
<a name="line-546"></a><a name="setDefaultTimeout"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-547"></a><span class='hs-definition'>setDefaultTimeout</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>MonadSnap</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Int</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span>
<a name="line-548"></a><span class='hs-definition'>setDefaultTimeout</span> <span class='hs-varid'>t</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>m</span> <span class='hs-layout'>{</span><span class='hs-varid'>defaultTimeout</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>t</span><span class='hs-layout'>}</span>
</pre></body>
</html>
