<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://www.cs.york.ac.uk/fp/darcs/hscolour/ -->
<title>src/Snap/Http/Server/Config.hs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="line-1"></a><span class='hs-comment'>{-# LANGUAGE CPP #-}</span>
<a name="line-2"></a><span class='hs-comment'>{-# LANGUAGE OverloadedStrings #-}</span>
<a name="line-3"></a>
<a name="line-4"></a><span class='hs-comment'>{-|
<a name="line-5"></a>
<a name="line-6"></a>This module exports the 'Config' datatype, which you can use to configure the
<a name="line-7"></a>Snap HTTP server.
<a name="line-8"></a>
<a name="line-9"></a>-}</span>
<a name="line-10"></a>
<a name="line-11"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>Snap</span><span class='hs-varop'>.</span><span class='hs-conid'>Http</span><span class='hs-varop'>.</span><span class='hs-conid'>Server</span><span class='hs-varop'>.</span><span class='hs-conid'>Config</span>
<a name="line-12"></a>  <span class='hs-layout'>(</span> <span class='hs-conid'>Config</span>
<a name="line-13"></a>  <span class='hs-layout'>,</span> <span class='hs-conid'>ConfigBackend</span><span class='hs-layout'>(</span><span class='hs-keyglyph'>..</span><span class='hs-layout'>)</span>
<a name="line-14"></a>
<a name="line-15"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>emptyConfig</span>
<a name="line-16"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>defaultConfig</span>
<a name="line-17"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>commandLineConfig</span>
<a name="line-18"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>completeConfig</span>
<a name="line-19"></a>
<a name="line-20"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>getAccessLog</span>
<a name="line-21"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>getBackend</span>
<a name="line-22"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>getBind</span>
<a name="line-23"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>getCompression</span>
<a name="line-24"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>getDefaultTimeout</span>
<a name="line-25"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>getErrorHandler</span>
<a name="line-26"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>getErrorLog</span>
<a name="line-27"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>getHostname</span>
<a name="line-28"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>getLocale</span>
<a name="line-29"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>getOther</span>
<a name="line-30"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>getPort</span>
<a name="line-31"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>getSSLBind</span>
<a name="line-32"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>getSSLCert</span>
<a name="line-33"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>getSSLKey</span>
<a name="line-34"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>getSSLPort</span>
<a name="line-35"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>getVerbose</span>
<a name="line-36"></a>
<a name="line-37"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>setAccessLog</span>
<a name="line-38"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>setBackend</span>
<a name="line-39"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>setBind</span>
<a name="line-40"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>setCompression</span>
<a name="line-41"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>setDefaultTimeout</span>
<a name="line-42"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>setErrorHandler</span>
<a name="line-43"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>setErrorLog</span>
<a name="line-44"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>setHostname</span>
<a name="line-45"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>setLocale</span>
<a name="line-46"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>setOther</span>
<a name="line-47"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>setPort</span>
<a name="line-48"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>setSSLBind</span>
<a name="line-49"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>setSSLCert</span>
<a name="line-50"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>setSSLKey</span>
<a name="line-51"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>setSSLPort</span>
<a name="line-52"></a>  <span class='hs-layout'>,</span> <span class='hs-varid'>setVerbose</span>
<a name="line-53"></a>  <span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-54"></a>
<a name="line-55"></a>
<a name="line-56"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>Blaze</span><span class='hs-varop'>.</span><span class='hs-conid'>ByteString</span><span class='hs-varop'>.</span><span class='hs-conid'>Builder</span>
<a name="line-57"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>Control</span><span class='hs-varop'>.</span><span class='hs-conid'>Exception</span> <span class='hs-layout'>(</span><span class='hs-conid'>SomeException</span><span class='hs-layout'>)</span>
<a name="line-58"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>Control</span><span class='hs-varop'>.</span><span class='hs-conid'>Monad</span>
<a name="line-59"></a><span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>ByteString</span><span class='hs-varop'>.</span><span class='hs-conid'>Char8</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>B</span>
<a name="line-60"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>ByteString</span> <span class='hs-layout'>(</span><span class='hs-conid'>ByteString</span><span class='hs-layout'>)</span>
<a name="line-61"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Char</span>
<a name="line-62"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Function</span>
<a name="line-63"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>List</span>
<a name="line-64"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Maybe</span>
<a name="line-65"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Monoid</span>
<a name="line-66"></a><span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Text</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>T</span>
<a name="line-67"></a><span class='hs-keyword'>import</span> <span class='hs-keyword'>qualified</span> <span class='hs-conid'>Data</span><span class='hs-varop'>.</span><span class='hs-conid'>Text</span><span class='hs-varop'>.</span><span class='hs-conid'>Encoding</span> <span class='hs-keyword'>as</span> <span class='hs-conid'>T</span>
<a name="line-68"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>Prelude</span> <span class='hs-varid'>hiding</span> <span class='hs-layout'>(</span><span class='hs-varid'>catch</span><span class='hs-layout'>)</span>
<a name="line-69"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>Snap</span><span class='hs-varop'>.</span><span class='hs-conid'>Types</span>
<a name="line-70"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>Snap</span><span class='hs-varop'>.</span><span class='hs-conid'>Iteratee</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-varop'>&gt;==&gt;</span><span class='hs-layout'>)</span><span class='hs-layout'>,</span> <span class='hs-varid'>enumBuilder</span><span class='hs-layout'>)</span>
<a name="line-71"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>Snap</span><span class='hs-varop'>.</span><span class='hs-conid'>Internal</span><span class='hs-varop'>.</span><span class='hs-conid'>Debug</span> <span class='hs-layout'>(</span><span class='hs-varid'>debug</span><span class='hs-layout'>)</span>
<a name="line-72"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>System</span><span class='hs-varop'>.</span><span class='hs-conid'>Console</span><span class='hs-varop'>.</span><span class='hs-conid'>GetOpt</span>
<a name="line-73"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>System</span><span class='hs-varop'>.</span><span class='hs-conid'>Environment</span> <span class='hs-varid'>hiding</span> <span class='hs-layout'>(</span><span class='hs-varid'>getEnv</span><span class='hs-layout'>)</span>
<a name="line-74"></a><span class='hs-cpp'>#ifndef PORTABLE</span>
<a name="line-75"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>System</span><span class='hs-varop'>.</span><span class='hs-conid'>Posix</span><span class='hs-varop'>.</span><span class='hs-conid'>Env</span>
<a name="line-76"></a><span class='hs-cpp'>#endif</span>
<a name="line-77"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>System</span><span class='hs-varop'>.</span><span class='hs-conid'>Exit</span>
<a name="line-78"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>System</span><span class='hs-varop'>.</span><span class='hs-conid'>IO</span>
<a name="line-79"></a>
<a name="line-80"></a>
<a name="line-81"></a><a name="ConfigBackend"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-82"></a><a name="ConfigBackend"></a><span class='hs-comment'>-- | This datatype allows you to override which backend (either simple or</span>
<a name="line-83"></a><a name="ConfigBackend"></a><span class='hs-comment'>-- libev) to use. Most users will not want to set this, preferring to rely on</span>
<a name="line-84"></a><a name="ConfigBackend"></a><span class='hs-comment'>-- the compile-type default.</span>
<a name="line-85"></a><a name="ConfigBackend"></a><span class='hs-comment'>--</span>
<a name="line-86"></a><a name="ConfigBackend"></a><span class='hs-comment'>-- Note that if you specify the libev backend and have not compiled in support</span>
<a name="line-87"></a><a name="ConfigBackend"></a><span class='hs-comment'>-- for it, your server will fail at runtime.</span>
<a name="line-88"></a><a name="ConfigBackend"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>ConfigBackend</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>ConfigSimpleBackend</span>
<a name="line-89"></a>                   <span class='hs-keyglyph'>|</span> <span class='hs-conid'>ConfigLibEvBackend</span>
<a name="line-90"></a>  <span class='hs-keyword'>deriving</span> <span class='hs-layout'>(</span><span class='hs-conid'>Show</span><span class='hs-layout'>,</span> <span class='hs-conid'>Eq</span><span class='hs-layout'>)</span>
<a name="line-91"></a>
<a name="line-92"></a><a name="Config"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-93"></a><a name="Config"></a><span class='hs-comment'>-- | A record type which represents partial configurations (for 'httpServe')</span>
<a name="line-94"></a><a name="Config"></a><span class='hs-comment'>-- by wrapping all of its fields in a 'Maybe'. Values of this type are usually</span>
<a name="line-95"></a><a name="Config"></a><span class='hs-comment'>-- constructed via its 'Monoid' instance by doing something like:</span>
<a name="line-96"></a><a name="Config"></a><span class='hs-comment'>--</span>
<a name="line-97"></a><a name="Config"></a><span class='hs-comment'>-- &gt; setPort 1234 mempty</span>
<a name="line-98"></a><a name="Config"></a><span class='hs-comment'>--</span>
<a name="line-99"></a><a name="Config"></a><span class='hs-comment'>-- Any fields which are unspecified in the 'Config' passed to 'httpServe' (and</span>
<a name="line-100"></a><a name="Config"></a><span class='hs-comment'>-- this is the norm) are filled in with default values from 'defaultConfig'.</span>
<a name="line-101"></a><a name="Config"></a><span class='hs-keyword'>data</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Config</span>
<a name="line-102"></a>    <span class='hs-layout'>{</span> <span class='hs-varid'>hostname</span>       <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>ByteString</span>
<a name="line-103"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>accessLog</span>      <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-conid'>FilePath</span><span class='hs-layout'>)</span>
<a name="line-104"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>errorLog</span>       <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-conid'>FilePath</span><span class='hs-layout'>)</span>
<a name="line-105"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>locale</span>         <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>String</span>
<a name="line-106"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>port</span>           <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>Int</span>
<a name="line-107"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>bind</span>           <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>ByteString</span>
<a name="line-108"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>sslport</span>        <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>Int</span>
<a name="line-109"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>sslbind</span>        <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>ByteString</span>
<a name="line-110"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>sslcert</span>        <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>FilePath</span>
<a name="line-111"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>sslkey</span>         <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>FilePath</span>
<a name="line-112"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>compression</span>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>Bool</span>
<a name="line-113"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>verbose</span>        <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>Bool</span>
<a name="line-114"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>errorHandler</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>SomeException</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span>
<a name="line-115"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>defaultTimeout</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>Int</span>
<a name="line-116"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>other</span>          <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-varid'>a</span>
<a name="line-117"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>backend</span>        <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>ConfigBackend</span>
<a name="line-118"></a>    <span class='hs-layout'>}</span>
<a name="line-119"></a>
<a name="line-120"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Show</span> <span class='hs-layout'>(</span><span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-121"></a>    <span class='hs-varid'>show</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>unlines</span> <span class='hs-keyglyph'>[</span> <span class='hs-str'>"Config:"</span>
<a name="line-122"></a>                     <span class='hs-layout'>,</span> <span class='hs-str'>"hostname: "</span>       <span class='hs-varop'>++</span> <span class='hs-sel'>_hostname</span>
<a name="line-123"></a>                     <span class='hs-layout'>,</span> <span class='hs-str'>"accessLog: "</span>      <span class='hs-varop'>++</span> <span class='hs-sel'>_accessLog</span>
<a name="line-124"></a>                     <span class='hs-layout'>,</span> <span class='hs-str'>"errorLog: "</span>       <span class='hs-varop'>++</span> <span class='hs-sel'>_errorLog</span>
<a name="line-125"></a>                     <span class='hs-layout'>,</span> <span class='hs-str'>"locale: "</span>         <span class='hs-varop'>++</span> <span class='hs-sel'>_locale</span>
<a name="line-126"></a>                     <span class='hs-layout'>,</span> <span class='hs-str'>"port: "</span>           <span class='hs-varop'>++</span> <span class='hs-sel'>_port</span>
<a name="line-127"></a>                     <span class='hs-layout'>,</span> <span class='hs-str'>"bind: "</span>           <span class='hs-varop'>++</span> <span class='hs-sel'>_bind</span>
<a name="line-128"></a>                     <span class='hs-layout'>,</span> <span class='hs-str'>"sslport: "</span>        <span class='hs-varop'>++</span> <span class='hs-sel'>_sslport</span>
<a name="line-129"></a>                     <span class='hs-layout'>,</span> <span class='hs-str'>"sslbind: "</span>        <span class='hs-varop'>++</span> <span class='hs-sel'>_sslbind</span>
<a name="line-130"></a>                     <span class='hs-layout'>,</span> <span class='hs-str'>"sslcert: "</span>        <span class='hs-varop'>++</span> <span class='hs-sel'>_sslcert</span>
<a name="line-131"></a>                     <span class='hs-layout'>,</span> <span class='hs-str'>"sslkey: "</span>         <span class='hs-varop'>++</span> <span class='hs-sel'>_sslkey</span>
<a name="line-132"></a>                     <span class='hs-layout'>,</span> <span class='hs-str'>"compression: "</span>    <span class='hs-varop'>++</span> <span class='hs-sel'>_compression</span>
<a name="line-133"></a>                     <span class='hs-layout'>,</span> <span class='hs-str'>"verbose: "</span>        <span class='hs-varop'>++</span> <span class='hs-sel'>_verbose</span>
<a name="line-134"></a>                     <span class='hs-layout'>,</span> <span class='hs-str'>"defaultTimeout: "</span> <span class='hs-varop'>++</span> <span class='hs-sel'>_defaultTimeout</span>
<a name="line-135"></a>                     <span class='hs-layout'>,</span> <span class='hs-str'>"backend: "</span>        <span class='hs-varop'>++</span> <span class='hs-sel'>_backend</span>
<a name="line-136"></a>                     <span class='hs-keyglyph'>]</span>
<a name="line-137"></a>
<a name="line-138"></a>      <span class='hs-keyword'>where</span>
<a name="line-139"></a>        <span class='hs-sel'>_hostname</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>show</span> <span class='hs-varop'>$</span> <span class='hs-varid'>hostname</span>       <span class='hs-varid'>c</span>
<a name="line-140"></a>        <span class='hs-sel'>_accessLog</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>show</span> <span class='hs-varop'>$</span> <span class='hs-varid'>accessLog</span>      <span class='hs-varid'>c</span>
<a name="line-141"></a>        <span class='hs-sel'>_errorLog</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>show</span> <span class='hs-varop'>$</span> <span class='hs-varid'>errorLog</span>       <span class='hs-varid'>c</span>
<a name="line-142"></a>        <span class='hs-sel'>_locale</span>         <span class='hs-keyglyph'>=</span> <span class='hs-varid'>show</span> <span class='hs-varop'>$</span> <span class='hs-varid'>locale</span>         <span class='hs-varid'>c</span>
<a name="line-143"></a>        <span class='hs-sel'>_port</span>           <span class='hs-keyglyph'>=</span> <span class='hs-varid'>show</span> <span class='hs-varop'>$</span> <span class='hs-varid'>port</span>           <span class='hs-varid'>c</span>
<a name="line-144"></a>        <span class='hs-sel'>_bind</span>           <span class='hs-keyglyph'>=</span> <span class='hs-varid'>show</span> <span class='hs-varop'>$</span> <span class='hs-varid'>bind</span>           <span class='hs-varid'>c</span>
<a name="line-145"></a>        <span class='hs-sel'>_sslport</span>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>show</span> <span class='hs-varop'>$</span> <span class='hs-varid'>sslport</span>        <span class='hs-varid'>c</span>
<a name="line-146"></a>        <span class='hs-sel'>_sslbind</span>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>show</span> <span class='hs-varop'>$</span> <span class='hs-varid'>sslbind</span>        <span class='hs-varid'>c</span>
<a name="line-147"></a>        <span class='hs-sel'>_sslcert</span>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>show</span> <span class='hs-varop'>$</span> <span class='hs-varid'>sslcert</span>        <span class='hs-varid'>c</span>
<a name="line-148"></a>        <span class='hs-sel'>_sslkey</span>         <span class='hs-keyglyph'>=</span> <span class='hs-varid'>show</span> <span class='hs-varop'>$</span> <span class='hs-varid'>sslkey</span>         <span class='hs-varid'>c</span>
<a name="line-149"></a>        <span class='hs-sel'>_compression</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>show</span> <span class='hs-varop'>$</span> <span class='hs-varid'>compression</span>    <span class='hs-varid'>c</span>
<a name="line-150"></a>        <span class='hs-sel'>_verbose</span>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>show</span> <span class='hs-varop'>$</span> <span class='hs-varid'>verbose</span>        <span class='hs-varid'>c</span>
<a name="line-151"></a>        <span class='hs-sel'>_defaultTimeout</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>show</span> <span class='hs-varop'>$</span> <span class='hs-varid'>defaultTimeout</span> <span class='hs-varid'>c</span>
<a name="line-152"></a>        <span class='hs-sel'>_backend</span>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>show</span> <span class='hs-varop'>$</span> <span class='hs-varid'>backend</span>        <span class='hs-varid'>c</span>
<a name="line-153"></a>
<a name="line-154"></a>
<a name="line-155"></a><a name="emptyConfig"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-156"></a><span class='hs-comment'>-- | Returns a completely empty 'Config'. Equivalent to 'mempty' from</span>
<a name="line-157"></a><span class='hs-comment'>-- 'Config''s 'Monoid' instance.</span>
<a name="line-158"></a><span class='hs-definition'>emptyConfig</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span>
<a name="line-159"></a><span class='hs-definition'>emptyConfig</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mempty</span>
<a name="line-160"></a>
<a name="line-161"></a>
<a name="line-162"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-163"></a><span class='hs-keyword'>instance</span> <span class='hs-conid'>Monoid</span> <span class='hs-layout'>(</span><span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span> <span class='hs-keyword'>where</span>
<a name="line-164"></a>    <span class='hs-varid'>mempty</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Config</span>
<a name="line-165"></a>        <span class='hs-layout'>{</span> <span class='hs-varid'>hostname</span>       <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-166"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>accessLog</span>      <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-167"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>errorLog</span>       <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-168"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>locale</span>         <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-169"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>port</span>           <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-170"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>bind</span>           <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-171"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>sslport</span>        <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-172"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>sslbind</span>        <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-173"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>sslcert</span>        <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-174"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>sslkey</span>         <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-175"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>compression</span>    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-176"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>verbose</span>        <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-177"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>errorHandler</span>   <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-178"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>defaultTimeout</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-179"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>other</span>          <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-180"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>backend</span>        <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Nothing</span>
<a name="line-181"></a>        <span class='hs-layout'>}</span>
<a name="line-182"></a>
<a name="line-183"></a>    <span class='hs-varid'>a</span> <span class='hs-varop'>`mappend`</span> <span class='hs-varid'>b</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Config</span>
<a name="line-184"></a>        <span class='hs-layout'>{</span> <span class='hs-varid'>hostname</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ov</span> <span class='hs-varid'>hostname</span>       <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<a name="line-185"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>accessLog</span>      <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ov</span> <span class='hs-varid'>accessLog</span>      <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<a name="line-186"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>errorLog</span>       <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ov</span> <span class='hs-varid'>errorLog</span>       <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<a name="line-187"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>locale</span>         <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ov</span> <span class='hs-varid'>locale</span>         <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<a name="line-188"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>port</span>           <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ov</span> <span class='hs-varid'>port</span>           <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<a name="line-189"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>bind</span>           <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ov</span> <span class='hs-varid'>bind</span>           <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<a name="line-190"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>sslport</span>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ov</span> <span class='hs-varid'>sslport</span>        <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<a name="line-191"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>sslbind</span>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ov</span> <span class='hs-varid'>sslbind</span>        <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<a name="line-192"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>sslcert</span>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ov</span> <span class='hs-varid'>sslcert</span>        <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<a name="line-193"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>sslkey</span>         <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ov</span> <span class='hs-varid'>sslkey</span>         <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<a name="line-194"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>compression</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ov</span> <span class='hs-varid'>compression</span>    <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<a name="line-195"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>verbose</span>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ov</span> <span class='hs-varid'>verbose</span>        <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<a name="line-196"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>errorHandler</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ov</span> <span class='hs-varid'>errorHandler</span>   <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<a name="line-197"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>defaultTimeout</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ov</span> <span class='hs-varid'>defaultTimeout</span> <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<a name="line-198"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>other</span>          <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ov</span> <span class='hs-varid'>other</span>          <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<a name="line-199"></a>        <span class='hs-layout'>,</span> <span class='hs-varid'>backend</span>        <span class='hs-keyglyph'>=</span> <span class='hs-varid'>ov</span> <span class='hs-varid'>backend</span>        <span class='hs-varid'>a</span> <span class='hs-varid'>b</span>
<a name="line-200"></a>        <span class='hs-layout'>}</span>
<a name="line-201"></a>      <span class='hs-keyword'>where</span>
<a name="line-202"></a>        <span class='hs-varid'>ov</span> <span class='hs-varid'>f</span> <span class='hs-varid'>x</span> <span class='hs-varid'>y</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>getLast</span> <span class='hs-varop'>$!</span> <span class='hs-layout'>(</span><span class='hs-varid'>mappend</span> <span class='hs-varop'>`on`</span> <span class='hs-layout'>(</span><span class='hs-conid'>Last</span> <span class='hs-varop'>.</span> <span class='hs-varid'>f</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span> <span class='hs-varid'>x</span> <span class='hs-varid'>y</span>
<a name="line-203"></a>
<a name="line-204"></a>
<a name="line-205"></a><a name="defaultConfig"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-206"></a><span class='hs-comment'>-- | These are the default values for the options</span>
<a name="line-207"></a><span class='hs-definition'>defaultConfig</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>MonadSnap</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span>
<a name="line-208"></a><span class='hs-definition'>defaultConfig</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mempty</span>
<a name="line-209"></a>    <span class='hs-layout'>{</span> <span class='hs-varid'>hostname</span>       <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-str'>"localhost"</span>
<a name="line-210"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>accessLog</span>      <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Just</span> <span class='hs-str'>"log/access.log"</span>
<a name="line-211"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>errorLog</span>       <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Just</span> <span class='hs-str'>"log/error.log"</span>
<a name="line-212"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>locale</span>         <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-str'>"en_US"</span>
<a name="line-213"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>compression</span>    <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-conid'>True</span>
<a name="line-214"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>verbose</span>        <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-conid'>True</span>
<a name="line-215"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>errorHandler</span>   <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>defaultErrorHandler</span>
<a name="line-216"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>bind</span>           <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-str'>"0.0.0.0"</span>
<a name="line-217"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>sslbind</span>        <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-str'>"0.0.0.0"</span>
<a name="line-218"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>sslcert</span>        <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-str'>"cert.pem"</span>
<a name="line-219"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>sslkey</span>         <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-str'>"key.pem"</span>
<a name="line-220"></a>    <span class='hs-layout'>,</span> <span class='hs-varid'>defaultTimeout</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-num'>60</span>
<a name="line-221"></a>    <span class='hs-layout'>}</span>
<a name="line-222"></a>
<a name="line-223"></a>
<a name="line-224"></a><a name="getHostname"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-225"></a><span class='hs-comment'>-- | The hostname of the HTTP server</span>
<a name="line-226"></a><span class='hs-definition'>getHostname</span>       <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>ByteString</span>
<a name="line-227"></a><span class='hs-definition'>getHostname</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>hostname</span>
<a name="line-228"></a>
<a name="line-229"></a><a name="getAccessLog"></a><span class='hs-comment'>-- | Path to the access log</span>
<a name="line-230"></a><span class='hs-definition'>getAccessLog</span>      <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-conid'>FilePath</span><span class='hs-layout'>)</span>
<a name="line-231"></a><span class='hs-definition'>getAccessLog</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>accessLog</span>
<a name="line-232"></a>
<a name="line-233"></a><a name="getErrorLog"></a><span class='hs-comment'>-- | Path to the error log</span>
<a name="line-234"></a><span class='hs-definition'>getErrorLog</span>       <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-conid'>FilePath</span><span class='hs-layout'>)</span>
<a name="line-235"></a><span class='hs-definition'>getErrorLog</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>errorLog</span>
<a name="line-236"></a>
<a name="line-237"></a><a name="getLocale"></a><span class='hs-comment'>-- | The locale to use</span>
<a name="line-238"></a><span class='hs-definition'>getLocale</span>         <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>String</span>
<a name="line-239"></a><span class='hs-definition'>getLocale</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>locale</span>
<a name="line-240"></a>
<a name="line-241"></a><a name="getPort"></a><span class='hs-comment'>-- | Returns the port to listen on (for http)</span>
<a name="line-242"></a><span class='hs-definition'>getPort</span>           <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>Int</span>
<a name="line-243"></a><span class='hs-definition'>getPort</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>port</span>
<a name="line-244"></a>
<a name="line-245"></a><a name="getBind"></a><span class='hs-comment'>-- | Returns the address to bind to (for http)</span>
<a name="line-246"></a><span class='hs-definition'>getBind</span>           <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>ByteString</span>
<a name="line-247"></a><span class='hs-definition'>getBind</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>bind</span>
<a name="line-248"></a>
<a name="line-249"></a><a name="getSSLPort"></a><span class='hs-comment'>-- | Returns the port to listen on (for https)</span>
<a name="line-250"></a><span class='hs-definition'>getSSLPort</span>        <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>Int</span>
<a name="line-251"></a><span class='hs-definition'>getSSLPort</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sslport</span>
<a name="line-252"></a>
<a name="line-253"></a><a name="getSSLBind"></a><span class='hs-comment'>-- | Returns the address to bind to (for https)</span>
<a name="line-254"></a><span class='hs-definition'>getSSLBind</span>        <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>ByteString</span>
<a name="line-255"></a><span class='hs-definition'>getSSLBind</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sslbind</span>
<a name="line-256"></a>
<a name="line-257"></a><a name="getSSLCert"></a><span class='hs-comment'>-- | Path to the SSL certificate file</span>
<a name="line-258"></a><span class='hs-definition'>getSSLCert</span>        <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>FilePath</span>
<a name="line-259"></a><span class='hs-definition'>getSSLCert</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sslcert</span>
<a name="line-260"></a>
<a name="line-261"></a><a name="getSSLKey"></a><span class='hs-comment'>-- | Path to the SSL key file</span>
<a name="line-262"></a><span class='hs-definition'>getSSLKey</span>         <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>FilePath</span>
<a name="line-263"></a><span class='hs-definition'>getSSLKey</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>sslkey</span>
<a name="line-264"></a>
<a name="line-265"></a><a name="getCompression"></a><span class='hs-comment'>-- | If set and set to True, compression is turned on when applicable</span>
<a name="line-266"></a><span class='hs-definition'>getCompression</span>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>Bool</span>
<a name="line-267"></a><span class='hs-definition'>getCompression</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>compression</span>
<a name="line-268"></a>
<a name="line-269"></a><a name="getVerbose"></a><span class='hs-comment'>-- | Whether to write server status updates to stderr</span>
<a name="line-270"></a><span class='hs-definition'>getVerbose</span>        <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>Bool</span>
<a name="line-271"></a><span class='hs-definition'>getVerbose</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>verbose</span>
<a name="line-272"></a>
<a name="line-273"></a><a name="getErrorHandler"></a><span class='hs-comment'>-- | A MonadSnap action to handle 500 errors</span>
<a name="line-274"></a><span class='hs-definition'>getErrorHandler</span>   <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>SomeException</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span>
<a name="line-275"></a><span class='hs-definition'>getErrorHandler</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>errorHandler</span>
<a name="line-276"></a>
<a name="line-277"></a><a name="getDefaultTimeout"></a><span class='hs-definition'>getDefaultTimeout</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>Int</span>
<a name="line-278"></a><span class='hs-definition'>getDefaultTimeout</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>defaultTimeout</span>
<a name="line-279"></a>
<a name="line-280"></a><a name="getOther"></a><span class='hs-definition'>getOther</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-varid'>a</span>
<a name="line-281"></a><span class='hs-definition'>getOther</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>other</span>
<a name="line-282"></a>
<a name="line-283"></a><a name="getBackend"></a><span class='hs-definition'>getBackend</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Maybe</span> <span class='hs-conid'>ConfigBackend</span>
<a name="line-284"></a><span class='hs-definition'>getBackend</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>backend</span>
<a name="line-285"></a>
<a name="line-286"></a>
<a name="line-287"></a><a name="setHostname"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-288"></a><span class='hs-definition'>setHostname</span>       <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ByteString</span>              <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span>
<a name="line-289"></a><span class='hs-definition'>setHostname</span> <span class='hs-varid'>x</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>c</span> <span class='hs-layout'>{</span> <span class='hs-varid'>hostname</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>x</span> <span class='hs-layout'>}</span>
<a name="line-290"></a>
<a name="line-291"></a><a name="setAccessLog"></a><span class='hs-definition'>setAccessLog</span>      <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-conid'>FilePath</span><span class='hs-layout'>)</span>        <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span>
<a name="line-292"></a><span class='hs-definition'>setAccessLog</span> <span class='hs-varid'>x</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>c</span> <span class='hs-layout'>{</span> <span class='hs-varid'>accessLog</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>x</span> <span class='hs-layout'>}</span>
<a name="line-293"></a>
<a name="line-294"></a><a name="setErrorLog"></a><span class='hs-definition'>setErrorLog</span>       <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-conid'>FilePath</span><span class='hs-layout'>)</span>        <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span>
<a name="line-295"></a><span class='hs-definition'>setErrorLog</span> <span class='hs-varid'>x</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>c</span> <span class='hs-layout'>{</span> <span class='hs-varid'>errorLog</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>x</span> <span class='hs-layout'>}</span>
<a name="line-296"></a>
<a name="line-297"></a><a name="setLocale"></a><span class='hs-definition'>setLocale</span>         <span class='hs-keyglyph'>::</span> <span class='hs-conid'>String</span>                  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span>
<a name="line-298"></a><span class='hs-definition'>setLocale</span> <span class='hs-varid'>x</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>c</span> <span class='hs-layout'>{</span> <span class='hs-varid'>locale</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>x</span> <span class='hs-layout'>}</span>
<a name="line-299"></a>
<a name="line-300"></a><a name="setPort"></a><span class='hs-definition'>setPort</span>           <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span>                     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span>
<a name="line-301"></a><span class='hs-definition'>setPort</span> <span class='hs-varid'>x</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>c</span> <span class='hs-layout'>{</span> <span class='hs-varid'>port</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>x</span> <span class='hs-layout'>}</span>
<a name="line-302"></a>
<a name="line-303"></a><a name="setBind"></a><span class='hs-definition'>setBind</span>           <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ByteString</span>              <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span>
<a name="line-304"></a><span class='hs-definition'>setBind</span> <span class='hs-varid'>x</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>c</span> <span class='hs-layout'>{</span> <span class='hs-varid'>bind</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>x</span> <span class='hs-layout'>}</span>
<a name="line-305"></a>
<a name="line-306"></a><a name="setSSLPort"></a><span class='hs-definition'>setSSLPort</span>        <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span>                     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span>
<a name="line-307"></a><span class='hs-definition'>setSSLPort</span> <span class='hs-varid'>x</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>c</span> <span class='hs-layout'>{</span> <span class='hs-varid'>sslport</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>x</span> <span class='hs-layout'>}</span>
<a name="line-308"></a>
<a name="line-309"></a><a name="setSSLBind"></a><span class='hs-definition'>setSSLBind</span>        <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ByteString</span>              <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span>
<a name="line-310"></a><span class='hs-definition'>setSSLBind</span> <span class='hs-varid'>x</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>c</span> <span class='hs-layout'>{</span> <span class='hs-varid'>sslbind</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>x</span> <span class='hs-layout'>}</span>
<a name="line-311"></a>
<a name="line-312"></a><a name="setSSLCert"></a><span class='hs-definition'>setSSLCert</span>        <span class='hs-keyglyph'>::</span> <span class='hs-conid'>FilePath</span>                <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span>
<a name="line-313"></a><span class='hs-definition'>setSSLCert</span> <span class='hs-varid'>x</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>c</span> <span class='hs-layout'>{</span> <span class='hs-varid'>sslcert</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>x</span> <span class='hs-layout'>}</span>
<a name="line-314"></a>
<a name="line-315"></a><a name="setSSLKey"></a><span class='hs-definition'>setSSLKey</span>         <span class='hs-keyglyph'>::</span> <span class='hs-conid'>FilePath</span>                <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span>
<a name="line-316"></a><span class='hs-definition'>setSSLKey</span> <span class='hs-varid'>x</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>c</span> <span class='hs-layout'>{</span> <span class='hs-varid'>sslkey</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>x</span> <span class='hs-layout'>}</span>
<a name="line-317"></a>
<a name="line-318"></a><a name="setCompression"></a><span class='hs-definition'>setCompression</span>    <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Bool</span>                    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span>
<a name="line-319"></a><span class='hs-definition'>setCompression</span> <span class='hs-varid'>x</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>c</span> <span class='hs-layout'>{</span> <span class='hs-varid'>compression</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>x</span> <span class='hs-layout'>}</span>
<a name="line-320"></a>
<a name="line-321"></a><a name="setVerbose"></a><span class='hs-definition'>setVerbose</span>        <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Bool</span>                    <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span>
<a name="line-322"></a><span class='hs-definition'>setVerbose</span> <span class='hs-varid'>x</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>c</span> <span class='hs-layout'>{</span> <span class='hs-varid'>verbose</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>x</span> <span class='hs-layout'>}</span>
<a name="line-323"></a>
<a name="line-324"></a><a name="setErrorHandler"></a><span class='hs-definition'>setErrorHandler</span>   <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>SomeException</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-conid'>()</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span>
<a name="line-325"></a><span class='hs-definition'>setErrorHandler</span> <span class='hs-varid'>x</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>c</span> <span class='hs-layout'>{</span> <span class='hs-varid'>errorHandler</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>x</span> <span class='hs-layout'>}</span>
<a name="line-326"></a>
<a name="line-327"></a><a name="setDefaultTimeout"></a><span class='hs-definition'>setDefaultTimeout</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Int</span>                     <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span>
<a name="line-328"></a><span class='hs-definition'>setDefaultTimeout</span> <span class='hs-varid'>x</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>c</span> <span class='hs-layout'>{</span> <span class='hs-varid'>defaultTimeout</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>x</span> <span class='hs-layout'>}</span>
<a name="line-329"></a>
<a name="line-330"></a><a name="setOther"></a><span class='hs-definition'>setOther</span>          <span class='hs-keyglyph'>::</span> <span class='hs-varid'>a</span>                       <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span>
<a name="line-331"></a><span class='hs-definition'>setOther</span> <span class='hs-varid'>x</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>c</span> <span class='hs-layout'>{</span> <span class='hs-varid'>other</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>x</span> <span class='hs-layout'>}</span>
<a name="line-332"></a>
<a name="line-333"></a><a name="setBackend"></a><span class='hs-definition'>setBackend</span>        <span class='hs-keyglyph'>::</span> <span class='hs-conid'>ConfigBackend</span>           <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span>
<a name="line-334"></a><span class='hs-definition'>setBackend</span> <span class='hs-varid'>x</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>c</span> <span class='hs-layout'>{</span> <span class='hs-varid'>backend</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>x</span> <span class='hs-layout'>}</span>
<a name="line-335"></a>
<a name="line-336"></a>
<a name="line-337"></a><a name="completeConfig"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-338"></a><span class='hs-definition'>completeConfig</span> <span class='hs-keyglyph'>::</span> <span class='hs-layout'>(</span><span class='hs-conid'>MonadSnap</span> <span class='hs-varid'>m</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-layout'>(</span><span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-339"></a><span class='hs-definition'>completeConfig</span> <span class='hs-varid'>config</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-340"></a>    <span class='hs-varid'>when</span> <span class='hs-varid'>noPort</span> <span class='hs-varop'>$</span> <span class='hs-varid'>hPutStrLn</span> <span class='hs-varid'>stderr</span> <span class='hs-str'>"no port specified, defaulting to port 8000"</span>
<a name="line-341"></a>
<a name="line-342"></a>    <span class='hs-varid'>return</span> <span class='hs-varop'>$</span> <span class='hs-varid'>cfg</span> <span class='hs-varop'>`mappend`</span> <span class='hs-varid'>cfg'</span>
<a name="line-343"></a>
<a name="line-344"></a>  <span class='hs-keyword'>where</span>
<a name="line-345"></a>    <span class='hs-varid'>cfg</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>defaultConfig</span> <span class='hs-varop'>`mappend`</span> <span class='hs-varid'>config</span>
<a name="line-346"></a>
<a name="line-347"></a>    <span class='hs-varid'>sslVals</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>map</span> <span class='hs-layout'>(</span><span class='hs-varop'>$</span> <span class='hs-varid'>cfg</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>[</span> <span class='hs-varid'>isJust</span> <span class='hs-varop'>.</span> <span class='hs-varid'>getSSLPort</span>
<a name="line-348"></a>                          <span class='hs-layout'>,</span> <span class='hs-varid'>isJust</span> <span class='hs-varop'>.</span> <span class='hs-varid'>getSSLBind</span>
<a name="line-349"></a>                          <span class='hs-layout'>,</span> <span class='hs-varid'>isJust</span> <span class='hs-varop'>.</span> <span class='hs-varid'>getSSLKey</span>
<a name="line-350"></a>                          <span class='hs-layout'>,</span> <span class='hs-varid'>isJust</span> <span class='hs-varop'>.</span> <span class='hs-varid'>getSSLCert</span> <span class='hs-keyglyph'>]</span>
<a name="line-351"></a>
<a name="line-352"></a>    <span class='hs-varid'>sslValid</span>   <span class='hs-keyglyph'>=</span> <span class='hs-varid'>and</span> <span class='hs-varid'>sslVals</span>
<a name="line-353"></a>    <span class='hs-varid'>noPort</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>isNothing</span> <span class='hs-layout'>(</span><span class='hs-varid'>getPort</span> <span class='hs-varid'>cfg</span><span class='hs-layout'>)</span> <span class='hs-varop'>&amp;&amp;</span> <span class='hs-varid'>not</span> <span class='hs-varid'>sslValid</span>
<a name="line-354"></a>
<a name="line-355"></a>    <span class='hs-varid'>cfg'</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>emptyConfig</span> <span class='hs-layout'>{</span> <span class='hs-varid'>port</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>if</span> <span class='hs-varid'>noPort</span> <span class='hs-keyword'>then</span> <span class='hs-conid'>Just</span> <span class='hs-num'>8000</span> <span class='hs-keyword'>else</span> <span class='hs-conid'>Nothing</span> <span class='hs-layout'>}</span>
<a name="line-356"></a>
<a name="line-357"></a>
<a name="line-358"></a><a name="fromString"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-359"></a><span class='hs-definition'>fromString</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>String</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>ByteString</span>
<a name="line-360"></a><span class='hs-definition'>fromString</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>T</span><span class='hs-varop'>.</span><span class='hs-varid'>encodeUtf8</span> <span class='hs-varop'>.</span> <span class='hs-conid'>T</span><span class='hs-varop'>.</span><span class='hs-varid'>pack</span>
<a name="line-361"></a>
<a name="line-362"></a>
<a name="line-363"></a><a name="options"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-364"></a><span class='hs-definition'>options</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>MonadSnap</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span>
<a name="line-365"></a>           <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span>
<a name="line-366"></a>        <span class='hs-keyglyph'>-&gt;</span> <span class='hs-keyglyph'>[</span><span class='hs-conid'>OptDescr</span> <span class='hs-layout'>(</span><span class='hs-conid'>Maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span><span class='hs-keyglyph'>]</span>
<a name="line-367"></a><span class='hs-definition'>options</span> <span class='hs-varid'>defaults</span> <span class='hs-keyglyph'>=</span>
<a name="line-368"></a>    <span class='hs-keyglyph'>[</span> <span class='hs-conid'>Option</span> <span class='hs-conid'>[]</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"hostname"</span><span class='hs-keyglyph'>]</span>
<a name="line-369"></a>             <span class='hs-layout'>(</span><span class='hs-conid'>ReqArg</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-varop'>.</span> <span class='hs-varid'>setConfig</span> <span class='hs-varid'>setHostname</span> <span class='hs-varop'>.</span> <span class='hs-varid'>fromString</span><span class='hs-layout'>)</span> <span class='hs-str'>"NAME"</span><span class='hs-layout'>)</span>
<a name="line-370"></a>             <span class='hs-varop'>$</span> <span class='hs-str'>"local hostname"</span> <span class='hs-varop'>++</span> <span class='hs-varid'>defaultC</span> <span class='hs-varid'>getHostname</span>
<a name="line-371"></a>    <span class='hs-layout'>,</span> <span class='hs-conid'>Option</span> <span class='hs-keyglyph'>[</span><span class='hs-chr'>'b'</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"address"</span><span class='hs-keyglyph'>]</span>
<a name="line-372"></a>             <span class='hs-layout'>(</span><span class='hs-conid'>ReqArg</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-varid'>mempty</span> <span class='hs-layout'>{</span> <span class='hs-varid'>bind</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-varid'>fromString</span> <span class='hs-varid'>s</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-373"></a>                     <span class='hs-str'>"ADDRESS"</span><span class='hs-layout'>)</span>
<a name="line-374"></a>             <span class='hs-varop'>$</span> <span class='hs-str'>"address to bind to"</span> <span class='hs-varop'>++</span> <span class='hs-varid'>defaultO</span> <span class='hs-varid'>bind</span>
<a name="line-375"></a>    <span class='hs-layout'>,</span> <span class='hs-conid'>Option</span> <span class='hs-keyglyph'>[</span><span class='hs-chr'>'p'</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"port"</span><span class='hs-keyglyph'>]</span>
<a name="line-376"></a>             <span class='hs-layout'>(</span><span class='hs-conid'>ReqArg</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-varid'>mempty</span> <span class='hs-layout'>{</span> <span class='hs-varid'>port</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-varid'>read</span> <span class='hs-varid'>s</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-str'>"PORT"</span><span class='hs-layout'>)</span>
<a name="line-377"></a>             <span class='hs-varop'>$</span> <span class='hs-str'>"port to listen on"</span> <span class='hs-varop'>++</span> <span class='hs-varid'>defaultO</span> <span class='hs-varid'>port</span>
<a name="line-378"></a>    <span class='hs-layout'>,</span> <span class='hs-conid'>Option</span> <span class='hs-conid'>[]</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"ssl-address"</span><span class='hs-keyglyph'>]</span>
<a name="line-379"></a>             <span class='hs-layout'>(</span><span class='hs-conid'>ReqArg</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-varid'>mempty</span> <span class='hs-layout'>{</span> <span class='hs-varid'>sslbind</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-varid'>fromString</span> <span class='hs-varid'>s</span> <span class='hs-layout'>}</span><span class='hs-layout'>)</span>
<a name="line-380"></a>                     <span class='hs-str'>"ADDRESS"</span><span class='hs-layout'>)</span>
<a name="line-381"></a>             <span class='hs-varop'>$</span> <span class='hs-str'>"ssl address to bind to"</span> <span class='hs-varop'>++</span> <span class='hs-varid'>defaultO</span> <span class='hs-varid'>sslbind</span>
<a name="line-382"></a>    <span class='hs-layout'>,</span> <span class='hs-conid'>Option</span> <span class='hs-conid'>[]</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"ssl-port"</span><span class='hs-keyglyph'>]</span>
<a name="line-383"></a>             <span class='hs-layout'>(</span><span class='hs-conid'>ReqArg</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-varid'>mempty</span> <span class='hs-layout'>{</span> <span class='hs-varid'>sslport</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-varid'>read</span> <span class='hs-varid'>s</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-str'>"PORT"</span><span class='hs-layout'>)</span>
<a name="line-384"></a>             <span class='hs-varop'>$</span> <span class='hs-str'>"ssl port to listen on"</span> <span class='hs-varop'>++</span> <span class='hs-varid'>defaultO</span> <span class='hs-varid'>sslport</span>
<a name="line-385"></a>    <span class='hs-layout'>,</span> <span class='hs-conid'>Option</span> <span class='hs-conid'>[]</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"ssl-cert"</span><span class='hs-keyglyph'>]</span>
<a name="line-386"></a>             <span class='hs-layout'>(</span><span class='hs-conid'>ReqArg</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-varid'>mempty</span> <span class='hs-layout'>{</span> <span class='hs-varid'>sslcert</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>s</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-str'>"PATH"</span><span class='hs-layout'>)</span>
<a name="line-387"></a>             <span class='hs-varop'>$</span> <span class='hs-str'>"path to ssl certificate in PEM format"</span> <span class='hs-varop'>++</span> <span class='hs-varid'>defaultO</span> <span class='hs-varid'>sslcert</span>
<a name="line-388"></a>    <span class='hs-layout'>,</span> <span class='hs-conid'>Option</span> <span class='hs-conid'>[]</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"ssl-key"</span><span class='hs-keyglyph'>]</span>
<a name="line-389"></a>             <span class='hs-layout'>(</span><span class='hs-conid'>ReqArg</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>s</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-varid'>mempty</span> <span class='hs-layout'>{</span> <span class='hs-varid'>sslkey</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varid'>s</span><span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-str'>"PATH"</span><span class='hs-layout'>)</span>
<a name="line-390"></a>             <span class='hs-varop'>$</span> <span class='hs-str'>"path to ssl private key in PEM format"</span> <span class='hs-varop'>++</span> <span class='hs-varid'>defaultO</span> <span class='hs-varid'>sslkey</span>
<a name="line-391"></a>    <span class='hs-layout'>,</span> <span class='hs-conid'>Option</span> <span class='hs-conid'>[]</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"access-log"</span><span class='hs-keyglyph'>]</span>
<a name="line-392"></a>             <span class='hs-layout'>(</span><span class='hs-conid'>ReqArg</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-varop'>.</span> <span class='hs-varid'>setConfig</span> <span class='hs-varid'>setAccessLog</span> <span class='hs-varop'>.</span> <span class='hs-conid'>Just</span><span class='hs-layout'>)</span> <span class='hs-str'>"PATH"</span><span class='hs-layout'>)</span>
<a name="line-393"></a>             <span class='hs-varop'>$</span> <span class='hs-str'>"access log"</span> <span class='hs-varop'>++</span> <span class='hs-layout'>(</span><span class='hs-varid'>defaultC</span> <span class='hs-varop'>$</span> <span class='hs-varid'>join</span> <span class='hs-varop'>.</span> <span class='hs-varid'>getAccessLog</span><span class='hs-layout'>)</span>
<a name="line-394"></a>    <span class='hs-layout'>,</span> <span class='hs-conid'>Option</span> <span class='hs-conid'>[]</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"error-log"</span><span class='hs-keyglyph'>]</span>
<a name="line-395"></a>             <span class='hs-layout'>(</span><span class='hs-conid'>ReqArg</span> <span class='hs-layout'>(</span><span class='hs-conid'>Just</span> <span class='hs-varop'>.</span> <span class='hs-varid'>setConfig</span> <span class='hs-varid'>setErrorLog</span> <span class='hs-varop'>.</span> <span class='hs-conid'>Just</span><span class='hs-layout'>)</span> <span class='hs-str'>"PATH"</span><span class='hs-layout'>)</span>
<a name="line-396"></a>             <span class='hs-varop'>$</span> <span class='hs-str'>"error log"</span> <span class='hs-varop'>++</span> <span class='hs-layout'>(</span><span class='hs-varid'>defaultC</span> <span class='hs-varop'>$</span> <span class='hs-varid'>join</span> <span class='hs-varop'>.</span> <span class='hs-varid'>getErrorLog</span><span class='hs-layout'>)</span>
<a name="line-397"></a>    <span class='hs-layout'>,</span> <span class='hs-conid'>Option</span> <span class='hs-conid'>[]</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"no-access-log"</span><span class='hs-keyglyph'>]</span>
<a name="line-398"></a>             <span class='hs-layout'>(</span><span class='hs-conid'>NoArg</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-varid'>setConfig</span> <span class='hs-varid'>setErrorLog</span> <span class='hs-conid'>Nothing</span><span class='hs-layout'>)</span>
<a name="line-399"></a>             <span class='hs-varop'>$</span> <span class='hs-str'>"don't have an access log"</span>
<a name="line-400"></a>    <span class='hs-layout'>,</span> <span class='hs-conid'>Option</span> <span class='hs-conid'>[]</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"no-error-log"</span><span class='hs-keyglyph'>]</span>
<a name="line-401"></a>             <span class='hs-layout'>(</span><span class='hs-conid'>NoArg</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-varid'>setConfig</span> <span class='hs-varid'>setAccessLog</span> <span class='hs-conid'>Nothing</span><span class='hs-layout'>)</span>
<a name="line-402"></a>             <span class='hs-varop'>$</span> <span class='hs-str'>"don't have an error log"</span>
<a name="line-403"></a>    <span class='hs-layout'>,</span> <span class='hs-conid'>Option</span> <span class='hs-keyglyph'>[</span><span class='hs-chr'>'c'</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"compression"</span><span class='hs-keyglyph'>]</span>
<a name="line-404"></a>             <span class='hs-layout'>(</span><span class='hs-conid'>NoArg</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-varid'>setConfig</span> <span class='hs-varid'>setCompression</span> <span class='hs-conid'>True</span><span class='hs-layout'>)</span>
<a name="line-405"></a>             <span class='hs-varop'>$</span> <span class='hs-str'>"use gzip compression on responses"</span>
<a name="line-406"></a>    <span class='hs-layout'>,</span> <span class='hs-conid'>Option</span> <span class='hs-keyglyph'>[</span><span class='hs-chr'>'t'</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"timeout"</span><span class='hs-keyglyph'>]</span>
<a name="line-407"></a>             <span class='hs-layout'>(</span><span class='hs-conid'>ReqArg</span> <span class='hs-layout'>(</span><span class='hs-keyglyph'>\</span><span class='hs-varid'>t</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-varid'>mempty</span> <span class='hs-layout'>{</span>
<a name="line-408"></a>                              <span class='hs-varid'>defaultTimeout</span> <span class='hs-keyglyph'>=</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-varid'>read</span> <span class='hs-varid'>t</span>
<a name="line-409"></a>                            <span class='hs-layout'>}</span><span class='hs-layout'>)</span> <span class='hs-str'>"SECS"</span><span class='hs-layout'>)</span>
<a name="line-410"></a>             <span class='hs-varop'>$</span> <span class='hs-str'>"set default timeout in seconds"</span>
<a name="line-411"></a>    <span class='hs-layout'>,</span> <span class='hs-conid'>Option</span> <span class='hs-conid'>[]</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"no-compression"</span><span class='hs-keyglyph'>]</span>
<a name="line-412"></a>             <span class='hs-layout'>(</span><span class='hs-conid'>NoArg</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-varid'>setConfig</span> <span class='hs-varid'>setCompression</span> <span class='hs-conid'>False</span><span class='hs-layout'>)</span>
<a name="line-413"></a>             <span class='hs-varop'>$</span> <span class='hs-str'>"serve responses uncompressed"</span>
<a name="line-414"></a>    <span class='hs-layout'>,</span> <span class='hs-conid'>Option</span> <span class='hs-keyglyph'>[</span><span class='hs-chr'>'v'</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"verbose"</span><span class='hs-keyglyph'>]</span>
<a name="line-415"></a>             <span class='hs-layout'>(</span><span class='hs-conid'>NoArg</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-varid'>setConfig</span> <span class='hs-varid'>setVerbose</span> <span class='hs-conid'>True</span><span class='hs-layout'>)</span>
<a name="line-416"></a>             <span class='hs-varop'>$</span> <span class='hs-str'>"print server status updates to stderr"</span>
<a name="line-417"></a>    <span class='hs-layout'>,</span> <span class='hs-conid'>Option</span> <span class='hs-keyglyph'>[</span><span class='hs-chr'>'q'</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"quiet"</span><span class='hs-keyglyph'>]</span>
<a name="line-418"></a>             <span class='hs-layout'>(</span><span class='hs-conid'>NoArg</span> <span class='hs-varop'>$</span> <span class='hs-conid'>Just</span> <span class='hs-varop'>$</span> <span class='hs-varid'>setConfig</span> <span class='hs-varid'>setVerbose</span> <span class='hs-conid'>False</span><span class='hs-layout'>)</span>
<a name="line-419"></a>             <span class='hs-varop'>$</span> <span class='hs-str'>"do not print anything to stderr"</span>
<a name="line-420"></a>    <span class='hs-layout'>,</span> <span class='hs-conid'>Option</span> <span class='hs-keyglyph'>[</span><span class='hs-chr'>'h'</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>[</span><span class='hs-str'>"help"</span><span class='hs-keyglyph'>]</span>
<a name="line-421"></a>             <span class='hs-layout'>(</span><span class='hs-conid'>NoArg</span> <span class='hs-conid'>Nothing</span><span class='hs-layout'>)</span>
<a name="line-422"></a>             <span class='hs-varop'>$</span> <span class='hs-str'>"display this help and exit"</span>
<a name="line-423"></a>    <span class='hs-keyglyph'>]</span>
<a name="line-424"></a>  <span class='hs-keyword'>where</span>
<a name="line-425"></a>    <span class='hs-varid'>setConfig</span> <span class='hs-varid'>f</span> <span class='hs-varid'>c</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>f</span> <span class='hs-varid'>c</span> <span class='hs-varid'>mempty</span>
<a name="line-426"></a>    <span class='hs-varid'>conf</span>          <span class='hs-keyglyph'>=</span> <span class='hs-varid'>defaultConfig</span> <span class='hs-varop'>`mappend`</span> <span class='hs-varid'>defaults</span>
<a name="line-427"></a>    <span class='hs-varid'>defaultC</span> <span class='hs-varid'>f</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>maybe</span> <span class='hs-str'>""</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-str'>", default "</span> <span class='hs-varop'>++</span><span class='hs-layout'>)</span> <span class='hs-varop'>.</span> <span class='hs-varid'>show</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-varid'>f</span> <span class='hs-varid'>conf</span>
<a name="line-428"></a>    <span class='hs-varid'>defaultO</span> <span class='hs-varid'>f</span>    <span class='hs-keyglyph'>=</span> <span class='hs-varid'>maybe</span> <span class='hs-str'>", default off"</span> <span class='hs-layout'>(</span><span class='hs-layout'>(</span><span class='hs-str'>", default "</span> <span class='hs-varop'>++</span><span class='hs-layout'>)</span> <span class='hs-varop'>.</span> <span class='hs-varid'>show</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span> <span class='hs-varid'>f</span> <span class='hs-varid'>conf</span>
<a name="line-429"></a>
<a name="line-430"></a>
<a name="line-431"></a>
<a name="line-432"></a>
<a name="line-433"></a><a name="defaultErrorHandler"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-434"></a><span class='hs-definition'>defaultErrorHandler</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>MonadSnap</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span> <span class='hs-conid'>SomeException</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>m</span> <span class='hs-conid'>()</span>
<a name="line-435"></a><span class='hs-definition'>defaultErrorHandler</span> <span class='hs-varid'>e</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-436"></a>    <span class='hs-varid'>debug</span> <span class='hs-str'>"Snap.Http.Server.Config errorHandler: got exception:"</span>
<a name="line-437"></a>    <span class='hs-varid'>debug</span> <span class='hs-varop'>$</span> <span class='hs-varid'>show</span> <span class='hs-varid'>e</span>
<a name="line-438"></a>    <span class='hs-varid'>logError</span> <span class='hs-varid'>msg</span>
<a name="line-439"></a>    <span class='hs-varid'>finishWith</span> <span class='hs-varop'>$</span> <span class='hs-varid'>setContentType</span> <span class='hs-str'>"text/plain; charset=utf-8"</span>
<a name="line-440"></a>               <span class='hs-varop'>.</span> <span class='hs-varid'>setContentLength</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromIntegral</span> <span class='hs-varop'>$</span> <span class='hs-conid'>B</span><span class='hs-varop'>.</span><span class='hs-varid'>length</span> <span class='hs-varid'>msg</span><span class='hs-layout'>)</span>
<a name="line-441"></a>               <span class='hs-varop'>.</span> <span class='hs-varid'>setResponseStatus</span> <span class='hs-num'>500</span> <span class='hs-str'>"Internal Server Error"</span>
<a name="line-442"></a>               <span class='hs-varop'>.</span> <span class='hs-varid'>modifyResponseBody</span>
<a name="line-443"></a>                     <span class='hs-layout'>(</span><span class='hs-varop'>&gt;==&gt;</span> <span class='hs-varid'>enumBuilder</span> <span class='hs-layout'>(</span><span class='hs-varid'>fromByteString</span> <span class='hs-varid'>msg</span><span class='hs-layout'>)</span><span class='hs-layout'>)</span>
<a name="line-444"></a>               <span class='hs-varop'>$</span> <span class='hs-varid'>emptyResponse</span>
<a name="line-445"></a>  <span class='hs-keyword'>where</span>
<a name="line-446"></a>    <span class='hs-varid'>err</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fromString</span> <span class='hs-varop'>$</span> <span class='hs-varid'>show</span> <span class='hs-varid'>e</span>
<a name="line-447"></a>    <span class='hs-varid'>msg</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>mappend</span> <span class='hs-str'>"A web handler threw an exception. Details:\n"</span> <span class='hs-varid'>err</span>
<a name="line-448"></a>
<a name="line-449"></a>
<a name="line-450"></a>
<a name="line-451"></a><a name="commandLineConfig"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-452"></a><span class='hs-comment'>-- | Returns a 'Config' obtained from parsing the options specified on the</span>
<a name="line-453"></a><span class='hs-comment'>-- command-line.</span>
<a name="line-454"></a><span class='hs-comment'>--</span>
<a name="line-455"></a><span class='hs-comment'>-- On Unix systems, the locale is read from the @LANG@ environment variable.</span>
<a name="line-456"></a><span class='hs-definition'>commandLineConfig</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>MonadSnap</span> <span class='hs-varid'>m</span> <span class='hs-keyglyph'>=&gt;</span>
<a name="line-457"></a>                     <span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span>   <span class='hs-comment'>-- ^ default configuration. This is combined</span>
<a name="line-458"></a>                                  <span class='hs-comment'>-- with 'defaultConfig' to obtain default</span>
<a name="line-459"></a>                                  <span class='hs-comment'>-- values to use if the given parameter is not</span>
<a name="line-460"></a>                                  <span class='hs-comment'>-- specified on the command line. Usually it is</span>
<a name="line-461"></a>                                  <span class='hs-comment'>-- fine to use 'emptyConfig' here.</span>
<a name="line-462"></a>                  <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>IO</span> <span class='hs-layout'>(</span><span class='hs-conid'>Config</span> <span class='hs-varid'>m</span> <span class='hs-varid'>a</span><span class='hs-layout'>)</span>
<a name="line-463"></a><span class='hs-definition'>commandLineConfig</span> <span class='hs-varid'>defaults</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-464"></a>    <span class='hs-varid'>args</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getArgs</span>
<a name="line-465"></a>    <span class='hs-varid'>prog</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getProgName</span>
<a name="line-466"></a>
<a name="line-467"></a>    <span class='hs-keyword'>let</span> <span class='hs-varid'>opts</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>options</span> <span class='hs-varid'>defaults</span>
<a name="line-468"></a>
<a name="line-469"></a>    <span class='hs-varid'>result</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>either</span> <span class='hs-layout'>(</span><span class='hs-varid'>usage</span> <span class='hs-varid'>prog</span> <span class='hs-varid'>opts</span><span class='hs-layout'>)</span>
<a name="line-470"></a>                     <span class='hs-varid'>return</span>
<a name="line-471"></a>                     <span class='hs-layout'>(</span><span class='hs-keyword'>case</span> <span class='hs-varid'>getOpt</span> <span class='hs-conid'>Permute</span> <span class='hs-varid'>opts</span> <span class='hs-varid'>args</span> <span class='hs-keyword'>of</span>
<a name="line-472"></a>                        <span class='hs-layout'>(</span><span class='hs-varid'>f</span><span class='hs-layout'>,</span> <span class='hs-keyword'>_</span><span class='hs-layout'>,</span> <span class='hs-conid'>[]</span>  <span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>maybe</span> <span class='hs-layout'>(</span><span class='hs-conid'>Left</span> <span class='hs-conid'>[]</span><span class='hs-layout'>)</span> <span class='hs-conid'>Right</span> <span class='hs-varop'>$</span>
<a name="line-473"></a>                                        <span class='hs-varid'>fmap</span> <span class='hs-varid'>mconcat</span> <span class='hs-varop'>$</span> <span class='hs-varid'>sequence</span> <span class='hs-varid'>f</span>
<a name="line-474"></a>                        <span class='hs-layout'>(</span><span class='hs-keyword'>_</span><span class='hs-layout'>,</span> <span class='hs-keyword'>_</span><span class='hs-layout'>,</span> <span class='hs-varid'>errs</span><span class='hs-layout'>)</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Left</span> <span class='hs-varid'>errs</span><span class='hs-layout'>)</span>
<a name="line-475"></a>
<a name="line-476"></a><span class='hs-cpp'>#ifndef PORTABLE</span>
<a name="line-477"></a>    <span class='hs-varid'>lang</span> <span class='hs-keyglyph'>&lt;-</span> <span class='hs-varid'>getEnv</span> <span class='hs-str'>"LANG"</span>
<a name="line-478"></a>    <span class='hs-varid'>completeConfig</span> <span class='hs-varop'>$</span> <span class='hs-varid'>mconcat</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>defaults</span><span class='hs-layout'>,</span>
<a name="line-479"></a>                              <span class='hs-varid'>mempty</span> <span class='hs-layout'>{</span><span class='hs-varid'>locale</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>fmap</span> <span class='hs-varid'>upToUtf8</span> <span class='hs-varid'>lang</span><span class='hs-layout'>}</span><span class='hs-layout'>,</span>
<a name="line-480"></a>                              <span class='hs-varid'>result</span><span class='hs-keyglyph'>]</span>
<a name="line-481"></a><span class='hs-cpp'>#else</span>
<a name="line-482"></a>    <span class='hs-varid'>completeConfig</span> <span class='hs-varop'>$</span> <span class='hs-varid'>mconcat</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>defaults</span><span class='hs-layout'>,</span> <span class='hs-varid'>result</span><span class='hs-keyglyph'>]</span>
<a name="line-483"></a><span class='hs-cpp'>#endif</span>
<a name="line-484"></a>
<a name="line-485"></a>  <span class='hs-keyword'>where</span>
<a name="line-486"></a>    <span class='hs-varid'>usage</span> <span class='hs-varid'>prog</span> <span class='hs-varid'>opts</span> <span class='hs-varid'>errs</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-487"></a>        <span class='hs-keyword'>let</span> <span class='hs-varid'>hdr</span> <span class='hs-keyglyph'>=</span> <span class='hs-str'>"Usage:\n  "</span> <span class='hs-varop'>++</span> <span class='hs-varid'>prog</span> <span class='hs-varop'>++</span> <span class='hs-str'>" [OPTION...]\n\nOptions:"</span>
<a name="line-488"></a>        <span class='hs-keyword'>let</span> <span class='hs-varid'>msg</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>concat</span> <span class='hs-varid'>errs</span> <span class='hs-varop'>++</span> <span class='hs-varid'>usageInfo</span> <span class='hs-varid'>hdr</span> <span class='hs-varid'>opts</span>
<a name="line-489"></a>        <span class='hs-varid'>hPutStrLn</span> <span class='hs-varid'>stderr</span> <span class='hs-varid'>msg</span>
<a name="line-490"></a>        <span class='hs-varid'>exitFailure</span>
<a name="line-491"></a><span class='hs-cpp'>#ifndef PORTABLE</span>
<a name="line-492"></a>    <span class='hs-varid'>upToUtf8</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>takeWhile</span> <span class='hs-varop'>$</span> <span class='hs-keyglyph'>\</span><span class='hs-varid'>c</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-varid'>isAlpha</span> <span class='hs-varid'>c</span> <span class='hs-varop'>||</span> <span class='hs-chr'>'_'</span> <span class='hs-varop'>==</span> <span class='hs-varid'>c</span>
<a name="line-493"></a><span class='hs-cpp'>#endif</span>
</pre></body>
</html>
