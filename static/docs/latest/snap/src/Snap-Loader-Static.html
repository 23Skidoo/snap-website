<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html>
<head>
<!-- Generated by HsColour, http://www.cs.york.ac.uk/fp/darcs/hscolour/ -->
<title>src/Snap/Loader/Static.hs</title>
<link type='text/css' rel='stylesheet' href='hscolour.css' />
</head>
<body>
<pre><a name="line-1"></a><span class='hs-comment'>{-# LANGUAGE TemplateHaskell #-}</span>
<a name="line-2"></a><span class='hs-comment'>-- | This module is a source-compatible replacement for</span>
<a name="line-3"></a><span class='hs-comment'>-- "Snap.Loader.Hint".  It does not import the GHC api, directly or</span>
<a name="line-4"></a><span class='hs-comment'>-- transitively, resulting in a greatly decreased binary size, as</span>
<a name="line-5"></a><span class='hs-comment'>-- compared to the Hint loader.</span>
<a name="line-6"></a><span class='hs-comment'>--</span>
<a name="line-7"></a><span class='hs-comment'>-- This module results in the same code as using the actions in the</span>
<a name="line-8"></a><span class='hs-comment'>-- obvious, straight-forward manner.  It is present *only* as a</span>
<a name="line-9"></a><span class='hs-comment'>-- source-level replacement for the Hint loader, to enable quickly</span>
<a name="line-10"></a><span class='hs-comment'>-- switching the Hint loader off with only a changed import.</span>
<a name="line-11"></a><span class='hs-keyword'>module</span> <span class='hs-conid'>Snap</span><span class='hs-varop'>.</span><span class='hs-conid'>Loader</span><span class='hs-varop'>.</span><span class='hs-conid'>Static</span> <span class='hs-keyword'>where</span>
<a name="line-12"></a>
<a name="line-13"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>Control</span><span class='hs-varop'>.</span><span class='hs-conid'>Arrow</span>
<a name="line-14"></a><span class='hs-keyword'>import</span>           <span class='hs-conid'>Language</span><span class='hs-varop'>.</span><span class='hs-conid'>Haskell</span><span class='hs-varop'>.</span><span class='hs-conid'>TH</span>
<a name="line-15"></a>
<a name="line-16"></a>
<a name="line-17"></a><a name="loadSnapTH"></a><span class='hs-comment'>------------------------------------------------------------------------------</span>
<a name="line-18"></a><span class='hs-comment'>-- | This function is a shim for source compatibility with loadSnapTH</span>
<a name="line-19"></a><span class='hs-comment'>-- in "Snap.Loader.Hint".  This function is a TH wrapper around a</span>
<a name="line-20"></a><span class='hs-comment'>-- hypothetical function:</span>
<a name="line-21"></a><span class='hs-comment'>--</span>
<a name="line-22"></a><span class='hs-comment'>-- &gt; loadSnap :: IO a -&gt; (a -&gt; IO ()) -&gt; (a -&gt; Snap ()) -&gt; IO (IO (), Snap ())</span>
<a name="line-23"></a><span class='hs-comment'>-- &gt; loadSnap initialize cleanup action = do</span>
<a name="line-24"></a><span class='hs-comment'>-- &gt;     i &lt;- initialize</span>
<a name="line-25"></a><span class='hs-comment'>-- &gt;     return (cleanup i, action i)</span>
<a name="line-26"></a><span class='hs-definition'>loadSnapTH</span> <span class='hs-keyglyph'>::</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Name</span> <span class='hs-keyglyph'>-&gt;</span> <span class='hs-conid'>Q</span> <span class='hs-conid'>Exp</span>
<a name="line-27"></a><span class='hs-definition'>loadSnapTH</span> <span class='hs-varid'>initialize</span> <span class='hs-varid'>cleanup</span> <span class='hs-varid'>action</span> <span class='hs-keyglyph'>=</span> <span class='hs-keyword'>do</span>
<a name="line-28"></a>    <span class='hs-keyword'>let</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>initE</span><span class='hs-layout'>,</span> <span class='hs-varid'>cleanE</span><span class='hs-layout'>,</span> <span class='hs-varid'>actE</span><span class='hs-keyglyph'>]</span> <span class='hs-keyglyph'>=</span> <span class='hs-varid'>map</span> <span class='hs-varid'>varE</span> <span class='hs-keyglyph'>[</span><span class='hs-varid'>initialize</span><span class='hs-layout'>,</span> <span class='hs-varid'>cleanup</span><span class='hs-layout'>,</span> <span class='hs-varid'>action</span><span class='hs-keyglyph'>]</span>
<a name="line-29"></a>
<a name="line-30"></a>    <span class='hs-keyglyph'>[</span><span class='hs-keyglyph'>|</span> <span class='hs-varid'>fmap</span> <span class='hs-layout'>(</span><span class='hs-varop'>$</span><span class='hs-varid'>cleanE</span> <span class='hs-varop'>&amp;&amp;&amp;</span> <span class='hs-varop'>$</span><span class='hs-varid'>actE</span><span class='hs-layout'>)</span> <span class='hs-varop'>$</span><span class='hs-varid'>initE</span> <span class='hs-keyglyph'>|</span><span class='hs-keyglyph'>]</span>
</pre></body>
</html>
