<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Snap.Extension</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><script src="haddock-util.js" type="text/javascript"></script><script type="text/javascript">//<![CDATA[
window.onload = function () {pageLoad();setSynopsis("mini_Snap-Extension.html");};
//]]>
</script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">snap-0.5.1: Snap: A Haskell Web Framework: project starter executable and glue code library</p></div><div id="content"><div id="module-header"><p class="caption">Snap.Extension</p></div><div id="table-of-contents"><p class="caption">Contents</p><ul><li><a href="#g:1">Introduction
</a><ul><li><a href="#g:2">Using Snap Extensions
</a><ul><li><a href="#g:3">Define Application State and Monad
</a></li><li><a href="#g:4">Provide Instances For &quot;HasState&quot; Classes
</a></li><li><a href="#g:5">Define The Initializer
</a></li><li><a href="#g:6">Simplified Snap Extension Server
</a></li></ul></li></ul></li></ul></div><div id="synopsis"><p id="control.syn" class="caption expander" onclick="toggleSection('syn')">Synopsis</p><ul id="section.syn" class="hide" onclick="toggleSection('syn')"><li class="src short"><span class="keyword">data</span>  <a href="#t:SnapExtend">SnapExtend</a> s a</li><li class="src short"><span class="keyword">data</span>  <a href="#t:Initializer">Initializer</a> s</li><li class="src short"><span class="keyword">class</span>  <a href="#t:InitializerState">InitializerState</a> s  <span class="keyword">where</span><ul class="subs"><li><a href="#v:extensionId">extensionId</a> :: s -&gt; <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/bytestring-0.9.1.10/Data-ByteString.html#t:ByteString">ByteString</a></li><li><a href="#v:mkCleanup">mkCleanup</a> :: s -&gt; <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.3.1.0/System-IO.html#t:IO">IO</a> <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/ghc-prim-0.2.0.0/GHC-Unit.html#t:-40--41-">()</a></li><li><a href="#v:mkReload">mkReload</a> :: s -&gt; <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.3.1.0/System-IO.html#t:IO">IO</a> <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/ghc-prim-0.2.0.0/GHC-Unit.html#t:-40--41-">()</a></li></ul></li><li class="src short"><a href="#v:runInitializer">runInitializer</a> ::  <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.3.1.0/Data-Bool.html#t:Bool">Bool</a> -&gt; <a href="Snap-Extension.html#t:Initializer">Initializer</a> s -&gt; <a href="Snap-Extension.html#t:SnapExtend">SnapExtend</a> s <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/ghc-prim-0.2.0.0/GHC-Unit.html#t:-40--41-">()</a> -&gt; <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.3.1.0/System-IO.html#t:IO">IO</a> (<a href="/Users/gdc/.cabal/share/doc/snap-core-0.5.1/html/Snap-Types.html#t:Snap">Snap</a> <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/ghc-prim-0.2.0.0/GHC-Unit.html#t:-40--41-">()</a>, <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.3.1.0/System-IO.html#t:IO">IO</a> <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/ghc-prim-0.2.0.0/GHC-Unit.html#t:-40--41-">()</a>, <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.3.1.0/System-IO.html#t:IO">IO</a> [(<a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/bytestring-0.9.1.10/Data-ByteString.html#t:ByteString">ByteString</a>, <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.3.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/bytestring-0.9.1.10/Data-ByteString.html#t:ByteString">ByteString</a>)])</li><li class="src short"><a href="#v:runInitializerWithReloadAction">runInitializerWithReloadAction</a> ::  <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.3.1.0/Data-Bool.html#t:Bool">Bool</a> -&gt; <a href="Snap-Extension.html#t:Initializer">Initializer</a> s -&gt; <a href="Snap-Extension.html#t:SnapExtend">SnapExtend</a> s <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/ghc-prim-0.2.0.0/GHC-Unit.html#t:-40--41-">()</a> -&gt; (<a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.3.1.0/System-IO.html#t:IO">IO</a> [(<a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/bytestring-0.9.1.10/Data-ByteString.html#t:ByteString">ByteString</a>, <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.3.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/bytestring-0.9.1.10/Data-ByteString.html#t:ByteString">ByteString</a>)] -&gt; <a href="Snap-Extension.html#t:SnapExtend">SnapExtend</a> s <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/ghc-prim-0.2.0.0/GHC-Unit.html#t:-40--41-">()</a>) -&gt; <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.3.1.0/System-IO.html#t:IO">IO</a> (<a href="/Users/gdc/.cabal/share/doc/snap-core-0.5.1/html/Snap-Types.html#t:Snap">Snap</a> <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/ghc-prim-0.2.0.0/GHC-Unit.html#t:-40--41-">()</a>, <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.3.1.0/System-IO.html#t:IO">IO</a> <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/ghc-prim-0.2.0.0/GHC-Unit.html#t:-40--41-">()</a>)</li><li class="src short"><a href="#v:runInitializerWithoutReloadAction">runInitializerWithoutReloadAction</a> ::  <a href="Snap-Extension.html#t:Initializer">Initializer</a> s -&gt; <a href="Snap-Extension.html#t:SnapExtend">SnapExtend</a> s <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/ghc-prim-0.2.0.0/GHC-Unit.html#t:-40--41-">()</a> -&gt; <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.3.1.0/System-IO.html#t:IO">IO</a> (<a href="/Users/gdc/.cabal/share/doc/snap-core-0.5.1/html/Snap-Types.html#t:Snap">Snap</a> <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/ghc-prim-0.2.0.0/GHC-Unit.html#t:-40--41-">()</a>, <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.3.1.0/System-IO.html#t:IO">IO</a> <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/ghc-prim-0.2.0.0/GHC-Unit.html#t:-40--41-">()</a>)</li><li class="src short"><a href="#v:mkInitializer">mkInitializer</a> :: <a href="Snap-Extension.html#t:InitializerState">InitializerState</a> s =&gt; s -&gt; <a href="Snap-Extension.html#t:Initializer">Initializer</a> s</li><li class="src short"><a href="#v:defaultReloadHandler">defaultReloadHandler</a> :: <a href="/Users/gdc/.cabal/share/doc/snap-core-0.5.1/html/Snap-Types.html#t:MonadSnap">MonadSnap</a> m =&gt; <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.3.1.0/System-IO.html#t:IO">IO</a> [(<a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/bytestring-0.9.1.10/Data-ByteString.html#t:ByteString">ByteString</a>, <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.3.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/bytestring-0.9.1.10/Data-ByteString.html#t:ByteString">ByteString</a>)] -&gt; m <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/ghc-prim-0.2.0.0/GHC-Unit.html#t:-40--41-">()</a></li><li class="src short"><a href="#v:nullReloadHandler">nullReloadHandler</a> :: <a href="/Users/gdc/.cabal/share/doc/snap-core-0.5.1/html/Snap-Types.html#t:MonadSnap">MonadSnap</a> m =&gt; <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.3.1.0/System-IO.html#t:IO">IO</a> [(<a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/bytestring-0.9.1.10/Data-ByteString.html#t:ByteString">ByteString</a>, <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.3.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/bytestring-0.9.1.10/Data-ByteString.html#t:ByteString">ByteString</a>)] -&gt; m <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/ghc-prim-0.2.0.0/GHC-Unit.html#t:-40--41-">()</a></li></ul></div><div id="interface"><h1 id="g:1">Introduction
</h1><div class="doc"><p>Snap Extensions is a library which makes it easy to create reusable plugins
  that extend your Snap application with modular chunks of functionality such
  as session management, user authentication, templating, or database
  connection pooling.
</p><p>We achieve this by requiring that you create a datatype that holds an
  environment for your application and wrap it around the Snap monad. This new
  construct becomes your application's handler monad and gives you access to
  your application state throughout your handlers.
</p><p>Warning: this interface is still EXPERIMENTAL and has a very high likelihood
  of changing substantially in coming versions of Snap.
</p></div><h2 id="g:2">Using Snap Extensions
</h2><div class="doc"><p>Every extension has an interface and at least one implementation of that
  interface.
</p><p>For some extensions, like Heist, there is only ever going to be one
  implementation of the interface. In these cases, both the interface and the
  implementation are exported from the same module, Snap.Extension.Heist.Impl.
</p><p>Hypothetically, for something like session management though, there could be
  multiple implementations, one using a HDBC backend, one using a MongoDB
  backend and one just using an encrypted cookie as backend. In these cases,
  the interface is exported from Snap.Extension.Session, and the
  implementations live in Snap.Extension.Session.HDBC,
  Snap.Extension.Session.MongoDB and Snap.Extension.Session.CookieStore.
</p><p>Keeping this in mind, there are a number of things you need to do to use
  Snap extensions in your application. Let's walk through how to set up a
  simple application with the Heist extension turned on.
</p></div><h3 id="g:3">Define Application State and Monad
</h3><div class="doc"><p>First, we define a record type AppState for holding our application's state,
  including the state needed by the extensions we're using.
</p><p>At the same time, we also define the monad for our application, App, as
  a type alias to <code>SnapExtend AppState</code>. <code><a href="Snap-Extension.html#t:SnapExtend">SnapExtend</a></code> is a <code><a href="/Users/gdc/.cabal/share/doc/snap-core-0.5.1/html/Snap-Types.html#t:MonadSnap">MonadSnap</a></code> and
  a <code>MonadReader</code>, whose environment is a given type; in our case, AppState.
</p><pre>
module App where

import Database.HDBC
import Database.HDBC.ODBC
import Snap.Extension
import Snap.Extension.Heist
import Snap.Types

type App = SnapExtend AppState

data AppState = AppState
    { heistState  :: HeistState App }
</pre><p>An important thing to note is that the -State types that we use in the
  fields of AppState are specific to each implementation of a extension's
  interface.  That is, Snap.Extension.Session.HDBC will export a different
  SessionState to Snap.Extension.Session.CookieStore, whose internal
  representation might be completely different.
</p><p>This state is what the extension's implementation needs to be able to do its
  job.
</p></div><h3 id="g:4">Provide Instances For &quot;HasState&quot; Classes
</h3><div class="doc"><p>Now we have a datatype that contains all the internal state needed by our
  application and the extensions it uses. That's a great start! But when do we
  actually get to use this interface and all the functionality that these
  extensions export?  What is actually being extended?
</p><p>We use the interface provided by an extension inside our application's
  monad, App. Snap extensions extend our App with new functionality by
  allowing us to user their exported functions inside of our handlers. For
  example, the Heist extension provides the function:
</p><p><code>render :: MonadHeist m =&gt; ByteString -&gt; m ()</code> that renders a template by
  its name.
</p><p>Is App a <code>MonadHeist</code>? Well, not quite yet. Any <code>MonadReader</code> which is also
  a <code><a href="/Users/gdc/.cabal/share/doc/snap-core-0.5.1/html/Snap-Types.html#t:MonadSnap">MonadSnap</a></code> whose environment contains a <code>HeistState</code> is a <code>MonadHeist</code>.
  That sounds a lot like our App, doesn't it? We just have to tell the Heist
  extension how to find the <code>HeistState</code> in our AppState:
</p><pre>
instance HasHeistState AppState where
    getHeistState = heistState
    setHeistState hs as = as { heistState = hs }
</pre><p>Stated another way, if we give our AppState the ability to hold a HeistState
  and let the HasHeistState typeclass know how to get/set this state, we are
  <em>automagically</em> given the ability to render heist templates in our handlers.
</p><p>With these instances, our application's monad App is now a MonadHeist
  giving it access to operations like:
</p><pre>render :: MonadHeist m =&gt; ByteString -&gt; m ()</pre><p>and
</p><pre>heistLocal :: (TemplateState n -&gt; TemplateState n) -&gt; m a -&gt; m a</pre></div><h3 id="g:5">Define The Initializer
</h3><div class="doc"><p>So, our monad is now a <code>MonadHeist</code>, but how do we actually construct our
  AppState and turn an App () into a <code><a href="/Users/gdc/.cabal/share/doc/snap-core-0.5.1/html/Snap-Types.html#t:Snap">Snap</a></code> ()? We need to do this upfront,
  once and right before our web server starts listening for connections.
</p><p>Snap extensions have a thing called an <code><a href="Snap-Extension.html#t:Initializer">Initializer</a></code> that does these things.
  Each implementation of a Snap extension interface provides an <code><a href="Snap-Extension.html#t:Initializer">Initializer</a></code>
  for its -State type. We must construct an initializer type for our -State
  type, AppState. An <code><a href="Snap-Extension.html#t:Initializer">Initializer</a></code> monad is provided in this library to make
  it easy to do this. For your convenience, <code><a href="Snap-Extension.html#t:Initializer">Initializer</a></code> is an instance of
  <code>MonadIO</code>.
</p><pre>
appInitializer :: Initializer AppState
appInitializer = do
    hs &lt;- heistInitializer &quot;resources/templates&quot;
    return $ AppState hs
</pre><p>In addition to constructing the AppState, the Initializer monad also
  constructs the init, destroy and reload functions for our application from
  the init, reload and destroy functions for the extensions.
</p><p>Although it won't cause a compile-time error, it is important to get the
  order of the initializers correct as much as possible, otherwise they may be
  reloaded and destroyed in the wrong order. The <a href="right.html">right</a> order is an order
  where every extension's dependencies are initialised before that extension.
  For example, Snap.Extension.Session.HDBC would depend on something which
  would extend the monad with MonadConnectionPool, i.e.,
  Snap.Extension.ConnectionPool. If you had this configuration it would be
  important that you put the connectionPoolInitializer before the
  sessionInitializer in your appInitializer.
</p><p>This Initializer AppState can then be passed to <code><a href="Snap-Extension.html#v:runInitializer">runInitializer</a></code>, which
  combines our initializer action with our application's handler to produce a
  <code><a href="/Users/gdc/.cabal/share/doc/snap-core-0.5.1/html/Snap-Types.html#t:Snap">Snap</a></code> handler (which can be passed to <code>httpServe</code>), a cleanup action (which
  you can run after <code>httpServe</code> finishes), and a reload action (which, for
  example, you may want to use in your handler for the path &quot;admin/reload&quot;.
</p><p>The following is an example of how you might use this in main:
</p><pre>
main :: IO ()
main = do
    (snap,cleanup,reload) &lt;- runInitializer appInitializer appSite
    let site = snap
               <a href="|">|</a> path <a href="admin/reload.html">admin/reload</a> $ defaultReloadHandler reload cleanup
    quickHttpServe site <code><a href="/Users/gdc/.cabal/share/doc/MonadCatchIO-transformers-0.2.2.2/html/Control-Monad-CatchIO.html#v:finally">finally</a></code> cleanup
</pre><p>You'll notice we're using <code><a href="Snap-Extension.html#v:defaultReloadHandler">defaultReloadHandler</a></code>. This is a function
  exported by <a href="Snap-Extension.html">Snap.Extension</a> with the type signature
</p><p><code>MonadSnap m =&gt; IO [(ByteString, Maybe ByteString)] -&gt; m ()</code> It takes the
  reload action returned by <code><a href="Snap-Extension.html#v:runInitializer">runInitializer</a></code> and returns a <code><a href="/Users/gdc/.cabal/share/doc/snap-core-0.5.1/html/Snap-Types.html#t:Snap">Snap</a></code> action which
  renders a simple page showing how the reload went. To avoid denial of
  service attacks, the reload handler only works for requests made from the
  local host.
</p></div><h3 id="g:6">Simplified Snap Extension Server
</h3><div class="doc"><p>This is, of course, a lot of avoidable boilerplate. Snap extensions framework
 comes with another module <a href="Snap-Extension-Server.html">Snap.Extension.Server</a>, which provides an
 interface mimicking that of <a href="Snap-Http-Server.html">Snap.Http.Server</a>. Their function names clash,
 so if you need to use both of them in the same module, use a qualified
 import. Using this module, the example above becomes:
</p><pre>
import Snap.Extension.Server

main :: IO ()
main = quickHttpServe appRunner site
</pre><p>All it needs is a Initializer AppState and an App () and it is ready to go.
  You might be wondering what happened to all the reload handler bits we
  had before: That stuff has been absorbed into the config for the server.
</p><p>One quick note: <code>quickHttpServe</code> doesn't take a config, instead it uses the
  defaults augmented with any options specified on the command-line.  The
  default reload handler path in this case is <a href="admin/reload.html">admin/reload</a>.
</p><p>If you wanted to change this to nullReloadHandler, you would do this:
</p><pre>
import Snap.Extension.Server

main :: IO ()
main = do
    config &lt;- commandLineConfig emptyConfig
    httpServe (setReloadHandler nullReloadHandler config) appRunner site
</pre><p>This behaves exactly as the above example apart from the reload handler.
</p><p>With this, we now have a fully functional base application that makes use of
  the Snap Extensions mechanism.
</p><p>To initialize a directory with all of this setup provided as a starting
  point, simply <code>cd</code> into the desired location and type: <code>snap init</code>. An
  example &quot;Timer&quot; extension will also be included for your convenience.
</p></div><div class="top"><p class="src"><span class="keyword">data</span>  <a name="t:SnapExtend" class="def">SnapExtend</a> s a </p><div class="doc"><p>A <code><a href="Snap-Extension.html#t:SnapExtend">SnapExtend</a></code> is a <code>MonadReader</code> and a <code><a href="/Users/gdc/.cabal/share/doc/snap-core-0.5.1/html/Snap-Types.html#t:MonadSnap">MonadSnap</a></code> whose environment is
 the application state for a given progam. You would usually type alias
 <code>SnapExtend AppState</code> to something like <code>App</code> to form the monad in which
 you write your application.
</p></div><div class="subs instances"><p id="control.i:SnapExtend" class="caption collapser" onclick="toggleSection('i:SnapExtend')">Instances</p><div id="section.i:SnapExtend" class="show"><table><tr><td class="src">MonadReader s (<a href="Snap-Extension.html#t:SnapExtend">SnapExtend</a> s)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.3.1.0/Control-Monad.html#t:Monad">Monad</a> (<a href="Snap-Extension.html#t:SnapExtend">SnapExtend</a> s)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.3.1.0/Control-Monad.html#t:Functor">Functor</a> (<a href="Snap-Extension.html#t:SnapExtend">SnapExtend</a> s)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.3.1.0/Control-Monad.html#t:MonadPlus">MonadPlus</a> (<a href="Snap-Extension.html#t:SnapExtend">SnapExtend</a> s)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.3.1.0/Control-Applicative.html#t:Applicative">Applicative</a> (<a href="Snap-Extension.html#t:SnapExtend">SnapExtend</a> s)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="/Users/gdc/.cabal/share/doc/MonadCatchIO-transformers-0.2.2.2/html/Control-Monad-CatchIO.html#t:MonadCatchIO">MonadCatchIO</a> (<a href="Snap-Extension.html#t:SnapExtend">SnapExtend</a> s)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.3.1.0/Control-Applicative.html#t:Alternative">Alternative</a> (<a href="Snap-Extension.html#t:SnapExtend">SnapExtend</a> s)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">MonadIO (<a href="Snap-Extension.html#t:SnapExtend">SnapExtend</a> s)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="/Users/gdc/.cabal/share/doc/snap-core-0.5.1/html/Snap-Types.html#t:MonadSnap">MonadSnap</a> (<a href="Snap-Extension.html#t:SnapExtend">SnapExtend</a> s)</td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="Snap-Extension-Heist-Impl.html#t:HasHeistState">HasHeistState</a> (<a href="Snap-Extension.html#t:SnapExtend">SnapExtend</a> s) s =&gt; <a href="Snap-Extension-Heist.html#t:MonadHeist">MonadHeist</a> (<a href="Snap-Extension.html#t:SnapExtend">SnapExtend</a> s) (<a href="Snap-Extension.html#t:SnapExtend">SnapExtend</a> s)</td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><span class="keyword">data</span>  <a name="t:Initializer" class="def">Initializer</a> s </p><div class="doc"><p>The <code><a href="Snap-Extension.html#t:Initializer">Initializer</a></code> monad. The code that initialises your application's
 state is written in the <code><a href="Snap-Extension.html#t:Initializer">Initializer</a></code> monad. It's used for constructing
 values which have cleanup/destroy and reload actions associated with them.
</p></div><div class="subs instances"><p id="control.i:Initializer" class="caption collapser" onclick="toggleSection('i:Initializer')">Instances</p><div id="section.i:Initializer" class="show"><table><tr><td class="src"><a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.3.1.0/Control-Monad.html#t:Monad">Monad</a> <a href="Snap-Extension.html#t:Initializer">Initializer</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.3.1.0/Control-Monad.html#t:Functor">Functor</a> <a href="Snap-Extension.html#t:Initializer">Initializer</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src"><a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.3.1.0/Control-Applicative.html#t:Applicative">Applicative</a> <a href="Snap-Extension.html#t:Initializer">Initializer</a></td><td class="doc empty">&nbsp;</td></tr><tr><td class="src">MonadIO <a href="Snap-Extension.html#t:Initializer">Initializer</a></td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><span class="keyword">class</span>  <a name="t:InitializerState" class="def">InitializerState</a> s  <span class="keyword">where</span></p><div class="doc"><p>Values of types which are instances of <code><a href="Snap-Extension.html#t:InitializerState">InitializerState</a></code> have
 cleanup/destroy and reload actions associated with them.
</p></div><div class="subs methods"><p class="caption">Methods</p><p class="src"><a name="v:extensionId" class="def">extensionId</a> :: s -&gt; <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/bytestring-0.9.1.10/Data-ByteString.html#t:ByteString">ByteString</a></p><p class="src"><a name="v:mkCleanup" class="def">mkCleanup</a> :: s -&gt; <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.3.1.0/System-IO.html#t:IO">IO</a> <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/ghc-prim-0.2.0.0/GHC-Unit.html#t:-40--41-">()</a></p><p class="src"><a name="v:mkReload" class="def">mkReload</a> :: s -&gt; <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.3.1.0/System-IO.html#t:IO">IO</a> <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/ghc-prim-0.2.0.0/GHC-Unit.html#t:-40--41-">()</a></p></div><div class="subs instances"><p id="control.i:InitializerState" class="caption collapser" onclick="toggleSection('i:InitializerState')">Instances</p><div id="section.i:InitializerState" class="show"><table><tr><td class="src"><a href="/Users/gdc/.cabal/share/doc/snap-core-0.5.1/html/Snap-Types.html#t:MonadSnap">MonadSnap</a> m =&gt; <a href="Snap-Extension.html#t:InitializerState">InitializerState</a> (<a href="Snap-Extension-Heist-Impl.html#t:HeistState">HeistState</a> m)</td><td class="doc empty">&nbsp;</td></tr></table></div></div></div><div class="top"><p class="src"><a name="v:runInitializer" class="def">runInitializer</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.3.1.0/Data-Bool.html#t:Bool">Bool</a></td><td class="doc"><p>Verbosity; info is printed to <code><a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.3.1.0/GHC-IO-Handle-FD.html#v:stderr">stderr</a></code> when this is <code><a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.3.1.0/Data-Bool.html#v:True">True</a></code>
</p></td></tr><tr><td class="src">-&gt; <a href="Snap-Extension.html#t:Initializer">Initializer</a> s</td><td class="doc"><p>The Initializer value
</p></td></tr><tr><td class="src">-&gt; <a href="Snap-Extension.html#t:SnapExtend">SnapExtend</a> s <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/ghc-prim-0.2.0.0/GHC-Unit.html#t:-40--41-">()</a></td><td class="doc"><p>A web handler in your application's monad
</p></td></tr><tr><td class="src">-&gt; <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.3.1.0/System-IO.html#t:IO">IO</a> (<a href="/Users/gdc/.cabal/share/doc/snap-core-0.5.1/html/Snap-Types.html#t:Snap">Snap</a> <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/ghc-prim-0.2.0.0/GHC-Unit.html#t:-40--41-">()</a>, <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.3.1.0/System-IO.html#t:IO">IO</a> <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/ghc-prim-0.2.0.0/GHC-Unit.html#t:-40--41-">()</a>, <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.3.1.0/System-IO.html#t:IO">IO</a> [(<a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/bytestring-0.9.1.10/Data-ByteString.html#t:ByteString">ByteString</a>, <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.3.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/bytestring-0.9.1.10/Data-ByteString.html#t:ByteString">ByteString</a>)])</td><td class="doc"><p>Returns a <code><a href="/Users/gdc/.cabal/share/doc/snap-core-0.5.1/html/Snap-Types.html#t:Snap">Snap</a></code> handler, a cleanup action, and a reload action. The
 list returned by the reload action is for error reporting. There is
 one tuple in the list for each Snap extension; the first element of
 the tuple is the name of the Snap extension, and the second is a Maybe
 which contains Nothing if there was no error reloading that extension
 and a Just with the ByteString containing the error message if there
 was.
</p></td></tr></table></div><div class="doc"><p>Given the Initializer for your application's state, and a value in the
 monad formed by <code><a href="Snap-Extension.html#t:SnapExtend">SnapExtend</a></code> wrapped it, this returns a <code><a href="/Users/gdc/.cabal/share/doc/snap-core-0.5.1/html/Snap-Types.html#t:Snap">Snap</a></code> action, a
 cleanup action and a reload action.
</p></div></div><div class="top"><p class="src"><a name="v:runInitializerWithReloadAction" class="def">runInitializerWithReloadAction</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.3.1.0/Data-Bool.html#t:Bool">Bool</a></td><td class="doc"><p>Verbosity; info is printed to <code><a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.3.1.0/GHC-IO-Handle-FD.html#v:stderr">stderr</a></code> when this is <code><a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.3.1.0/Data-Bool.html#v:True">True</a></code>
</p></td></tr><tr><td class="src">-&gt; <a href="Snap-Extension.html#t:Initializer">Initializer</a> s</td><td class="doc"><p>The Initializer value
</p></td></tr><tr><td class="src">-&gt; <a href="Snap-Extension.html#t:SnapExtend">SnapExtend</a> s <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/ghc-prim-0.2.0.0/GHC-Unit.html#t:-40--41-">()</a></td><td class="doc"><p>A web handler in your application's monad.
</p></td></tr><tr><td class="src">-&gt; (<a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.3.1.0/System-IO.html#t:IO">IO</a> [(<a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/bytestring-0.9.1.10/Data-ByteString.html#t:ByteString">ByteString</a>, <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.3.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/bytestring-0.9.1.10/Data-ByteString.html#t:ByteString">ByteString</a>)] -&gt; <a href="Snap-Extension.html#t:SnapExtend">SnapExtend</a> s <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/ghc-prim-0.2.0.0/GHC-Unit.html#t:-40--41-">()</a>)</td><td class="doc"><p>Your desired &quot;reload&quot; handler; it gets passed the reload
 action. This handler is always run, so you have to guard the path
 yourself (with.
</p></td></tr><tr><td class="src">-&gt; <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.3.1.0/System-IO.html#t:IO">IO</a> (<a href="/Users/gdc/.cabal/share/doc/snap-core-0.5.1/html/Snap-Types.html#t:Snap">Snap</a> <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/ghc-prim-0.2.0.0/GHC-Unit.html#t:-40--41-">()</a>, <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.3.1.0/System-IO.html#t:IO">IO</a> <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/ghc-prim-0.2.0.0/GHC-Unit.html#t:-40--41-">()</a>)</td><td class="doc"><p>Your <code><a href="/Users/gdc/.cabal/share/doc/snap-core-0.5.1/html/Snap-Types.html#t:Snap">Snap</a></code> handler and a cleanup action.
</p></td></tr></table></div><div class="doc"><p>Serves the same purpose as <code><a href="Snap-Extension.html#v:runInitializer">runInitializer</a></code>, but combines the
   application's web handler with a user-supplied action to be run to reload
   the application's state.
</p></div></div><div class="top"><p class="src"><a name="v:runInitializerWithoutReloadAction" class="def">runInitializerWithoutReloadAction</a></p><div class="subs arguments"><p class="caption">Arguments</p><table><tr><td class="src">:: <a href="Snap-Extension.html#t:Initializer">Initializer</a> s</td><td class="doc"><p>The Initializer value
</p></td></tr><tr><td class="src">-&gt; <a href="Snap-Extension.html#t:SnapExtend">SnapExtend</a> s <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/ghc-prim-0.2.0.0/GHC-Unit.html#t:-40--41-">()</a></td><td class="doc"><p>An action in your application's monad.
</p></td></tr><tr><td class="src">-&gt; <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.3.1.0/System-IO.html#t:IO">IO</a> (<a href="/Users/gdc/.cabal/share/doc/snap-core-0.5.1/html/Snap-Types.html#t:Snap">Snap</a> <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/ghc-prim-0.2.0.0/GHC-Unit.html#t:-40--41-">()</a>, <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.3.1.0/System-IO.html#t:IO">IO</a> <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/ghc-prim-0.2.0.0/GHC-Unit.html#t:-40--41-">()</a>)</td><td class="doc empty">&nbsp;</td></tr></table></div><div class="doc"><p>A cut-down version of <code><a href="Snap-Extension.html#v:runInitializer">runInitializer</a></code>, for use by the hint
 loading code
</p></div></div><div class="top"><p class="src"><a name="v:mkInitializer" class="def">mkInitializer</a> :: <a href="Snap-Extension.html#t:InitializerState">InitializerState</a> s =&gt; s -&gt; <a href="Snap-Extension.html#t:Initializer">Initializer</a> s</p><div class="doc"><p>Although it has the same type signature, this is not the same as <code><a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.3.1.0/Control-Monad.html#v:return">return</a></code>
 in the <code><a href="Snap-Extension.html#t:Initializer">Initializer</a></code> monad. Return simply lifts a value into the
 <code><a href="Snap-Extension.html#t:Initializer">Initializer</a></code> monad, but this lifts the value and its destroy/reload
 actions. Use this when making your own <code><a href="Snap-Extension.html#t:Initializer">Initializer</a></code> actions.
</p></div></div><div class="top"><p class="src"><a name="v:defaultReloadHandler" class="def">defaultReloadHandler</a> :: <a href="/Users/gdc/.cabal/share/doc/snap-core-0.5.1/html/Snap-Types.html#t:MonadSnap">MonadSnap</a> m =&gt; <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.3.1.0/System-IO.html#t:IO">IO</a> [(<a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/bytestring-0.9.1.10/Data-ByteString.html#t:ByteString">ByteString</a>, <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.3.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/bytestring-0.9.1.10/Data-ByteString.html#t:ByteString">ByteString</a>)] -&gt; m <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/ghc-prim-0.2.0.0/GHC-Unit.html#t:-40--41-">()</a></p><div class="doc"><p>This takes the last value of the tuple returned by <code><a href="Snap-Extension.html#v:runInitializer">runInitializer</a></code>,
 which is a list representing the results of an attempt to reload the
 application's Snap Extensions, and turns it into a Snap action which
 displays the these results.
</p></div></div><div class="top"><p class="src"><a name="v:nullReloadHandler" class="def">nullReloadHandler</a> :: <a href="/Users/gdc/.cabal/share/doc/snap-core-0.5.1/html/Snap-Types.html#t:MonadSnap">MonadSnap</a> m =&gt; <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.3.1.0/System-IO.html#t:IO">IO</a> [(<a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/bytestring-0.9.1.10/Data-ByteString.html#t:ByteString">ByteString</a>, <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/base-4.3.1.0/Data-Maybe.html#t:Maybe">Maybe</a> <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/bytestring-0.9.1.10/Data-ByteString.html#t:ByteString">ByteString</a>)] -&gt; m <a href="/Library/Frameworks/GHC.framework/Versions/7.0.3-x86_64/usr/share/doc/ghc/html/libraries/ghc-prim-0.2.0.0/GHC-Unit.html#t:-40--41-">()</a></p><div class="doc"><p>Use this reload handler to disable the ability to have a web handler
 which reloads Snap extensions.
</p></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.9.2</p></div></body></html>